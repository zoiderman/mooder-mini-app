(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,533568,416872,680126,689280,e=>{"use strict";e.s(["default",()=>s_],533568);var t=e.i(637651),s=e.i(76756),a=e.i(700585),i=e.i(315366),n=e.i(850821),r=e.i(246429),o=e.i(637797),l=e.i(72290),c=e.i(497985);e.i(685846);var d=e.i(376098),u=e.i(90476),m=e.i(12465),p=e.i(510965);let g=(0,p.default)("FlipHorizontal",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h3",key:"1i73f7"}],["path",{d:"M16 3h3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-3",key:"saxlbk"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 14v2",key:"8jcxud"}],["path",{d:"M12 8v2",key:"1woqiv"}],["path",{d:"M12 2v2",key:"tus03m"}]]);var h=e.i(443696),x=e.i(889963),f=e.i(122088),v=e.i(969736),y=e.i(486492),b=e.i(179314),j=e.i(623434),S=e.i(353315);e.i(968648);var I=e.i(873329),w=e.i(723008);let N=e=>{let{hasImage:s,prompt:a,onParentPeek:i,focusedImageUrl:n,parentImageUrl:o,isStreaming:l,onRegenerate:p,onClose:N}=e,{t:C}=(0,I.useTranslation)("base"),[k,M]=(0,S.useState)(!1),[T,E]=(0,S.useState)(void 0),[P,D]=(0,S.useState)(!1),_=(0,f.useMobileUa)(),A=(0,r.useChatPageStore)(e=>e.conversationId),R=(0,r.useChatPageStore)(e=>e.lastMessageId),{editImagePresets:L}=(0,x.useEditImagePresets)(),O=(0,S.useMemo)(()=>{if(!T)return;let e=L.flatMap(e=>e.presets).find(e=>e.prompt===T);return e?(0,t.jsxs)(t.Fragment,{children:[e.icon&&S.default.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),(0,t.jsx)("h1",{className:"text-lg font-semibold truncate",children:e.label})]}):(0,t.jsx)("h1",{className:"text-lg font-semibold truncate",children:T})},[T,L]),z=(0,S.useCallback)(()=>{!P&&n&&(D(!0),(0,v.downloadImage)(n,null==n?void 0:n.split("/").pop()).catch((0,y.createLogError)("image-editor:handleDownload")).finally(()=>D(!1)))},[n,P]);return(0,S.useEffect)(()=>{a&&T!==a&&E(a)},[a,T]),(0,S.useEffect)(()=>{o&&!k&&M(!0)},[o,k]),(0,t.jsx)("header",{className:"flex justify-between w-full items-center min-h-10 gap-3  relative z-30 flex-shrink-0",children:(0,t.jsxs)(b.AnimatePresence,{mode:"popLayout",children:[T&&(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"flex items-center gap-2 w-full overflow-hidden min-w-0",children:O},T),(0,t.jsxs)("div",{className:"flex gap-1 ms-auto shrink-0",children:[(0,t.jsxs)(t.Fragment,{children:[k&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,t.jsx)(h.ButtonWithTooltip,{variant:"secondary",shape:"circle",size:"md","aria-label":C("Compare","Compare"),tooltipContent:C("Compare","Compare"),tooltipContentProps:{side:"bottom"},onMouseDown:()=>i(!0),onMouseUp:()=>i(!1),onMouseLeave:()=>i(!1),onTouchStart:e=>{e.preventDefault(),e.stopPropagation(),i(!0)},onTouchEnd:e=>{e.preventDefault(),e.stopPropagation(),i(!1)},onContextMenu:e=>{e.preventDefault(),e.stopPropagation()},onContextMenuCapture:e=>{e.preventDefault(),e.stopPropagation()},asChild:!0,disabled:l||!o,children:(0,t.jsx)(j.motion.button,{whileTap:!l&&o?{scale:.9}:void 0,children:(0,t.jsx)(g,{className:"size-5"})})})},"compare"),(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,t.jsx)(h.ButtonWithTooltip,{size:"md",variant:"tertiary",shape:"circle",className:"text-fg-primary","aria-label":C("Regenerate","Regenerate"),tooltipContent:C("Regenerate","Regenerate"),tooltipContentProps:{side:"bottom"},asChild:!0,disabled:l||!o,onClick:p,children:(0,t.jsx)(j.motion.button,{whileTap:!l&&o?{scale:.9}:void 0,children:(0,t.jsx)(u.RefreshCwIcon,{className:"size-5"})})})},"regenerate")]}),s&&(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,t.jsx)(h.ButtonWithTooltip,{variant:"tertiary",size:"md",shape:"circle",className:"text-fg-primary","aria-label":C("Download Image","Download Image"),tooltipContent:C("Download Image","Download Image"),tooltipContentProps:{side:"bottom"},disabled:l||!n||P,onClick:z,children:P?(0,t.jsx)(w.Spinner,{size:"xs"}):(0,t.jsx)(d.DownloadIcon,{className:"size-5"})})},"download"),A&&R&&(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,t.jsx)(c.ShareButton,{variant:"tertiary",size:"md",shape:"pill",className:"text-fg-primary",showLabel:!0,conversationId:A,responseId:R,iconProps:{size:20}})},"share")]}),_?(0,t.jsx)(h.Button,{"aria-label":C("Close Image Editor","Close Image Editor"),variant:"secondary",size:"md",shape:"circle",onClick:N,children:(0,t.jsx)(m.XIcon,{size:20})}):(0,t.jsx)(h.ButtonWithTooltip,{"aria-label":C("Close Image Editor","Close Image Editor"),tooltipContent:C("Close Image Editor","Close Image Editor"),tooltipContentProps:{side:"bottom"},variant:"secondary",size:"md",shape:"circle",onClick:N,children:(0,t.jsx)(m.XIcon,{size:20})})]})]})})};var C=e.i(448888),k=e.i(211959);let M=e=>{let{images:s,focusedOption:a,isStreaming:i,onSelect:n}=e;return(0,t.jsx)(j.motion.aside,{className:"lg:fixed top-0 inset-0 lg:top-0 lg:right-0 lg:left-auto flex lg:flex-col items-center justify-center lg:h-full gap-4 pb-3 lg:p-6 pointer-events-none z-30",variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,t.jsx)(b.AnimatePresence,{mode:"popLayout",children:s.map((e,s)=>(0,t.jsx)(j.motion.button,{className:(0,k.cn)("size-16 sm:size-20 relative rounded-xl border bg-background p-1 pointer-events-auto",{"ring-primary ring-2":s===a}),onClick:()=>n(s),whileTap:s!==a?{scale:.95}:{},variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,t.jsx)("div",{className:"relative h-full w-full overflow-hidden rounded-lg",children:(0,t.jsx)("figure",{className:"absolute -translate-x-1/2 left-1/2 h-full aspect-[4/3]",children:(0,t.jsx)(C.GrokImage,{isModerated:e.isModerated,status:i?"streaming":"finished",iconSize:24,intermediateResults:i?e.progressMap:[{progress:1,imageUrl:e.url}]})})})},e.id))})},"image-editor-option-nav")};var T=e.i(310158),E=e.i(383274),P=e.i(50636),D=e.i(592766),_=e.i(511765),A=e.i(920958),R=e.i(259473),L=e.i(688578),O=e.i(536459),z=e.i(159422),U=e.i(470753),B=e.i(633918),F=e.i(221045),G=e.i(715127);let H=e=>{let{isEditingCurrentImage:s,setIsPeekingParent:a,isPeekingParent:i,focusedImage:n,parentImageUrl:r,generatedImageHeight:o,generatedImageWidth:l,isFinalImageLoaded:c,setIsFinalImageLoaded:d,isParentImageLoaded:u,setIsParentImageLoaded:m}=e,[p,g]=(0,S.useState)([]),[h,x]=(0,S.useState)(!1),[f,v]=(0,S.useState)(!1),[y,I]=(0,S.useState)(!0),w=(0,S.useMemo)(()=>!!(o&&l),[o,l]),N=(0,S.useMemo)(()=>o&&l?l/o:4/3,[o,l]);return(0,S.useEffect)(()=>{(s||!y)&&(null==n?void 0:n.progressMap)?g(n.progressMap):!s&&(null==n?void 0:n.url)?g(e=>[...e,{progress:1,imageUrl:n.url||""}]):g([])},[s,null==n?void 0:n.url,null==n?void 0:n.progressMap,y]),(0,S.useEffect)(()=>{if(!h)return void a(!1);let e=setTimeout(()=>{h&&!f&&a(!0)},100);return()=>clearTimeout(e)},[h,f,a]),(0,S.useEffect)(()=>{s&&y&&I(!1),s||!c||y||I(!0)},[s,c,y]),(0,t.jsx)("figure",{className:(0,k.cn)("relative group/image w-full max-w-5xl 2xl:max-w-6xl overflow-hidden rounded-lg select-none",!s&&r&&(i?"cursor-grabbing":"cursor-grab")),onDragStart:e=>{if(i)return void e.preventDefault();v(!0)},onDragEnd:()=>{v(!1),x(!1)},onMouseDown:e=>{0===e.button&&x(!0)},onMouseUp:()=>x(!1),onTouchStart:e=>{e.preventDefault(),e.stopPropagation(),x(!0)},onTouchEnd:e=>{e.preventDefault(),x(!1)},onMouseLeave:()=>{x(!1),v(!1)},children:(0,t.jsx)(b.AnimatePresence,{mode:"wait",children:s||!y?w?(0,t.jsx)(j.motion.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},exit:{opacity:1,filter:"blur(0px)",transition:{delay:1.5}},transition:{ease:"easeInOut"},className:"h-full mx-auto",style:{aspectRatio:N,maxHeight:o},children:(0,t.jsx)(C.GrokImage,{status:"streaming",intermediateResults:p,isModerated:null==n?void 0:n.isModerated,aspectRatio:N})},"streaming-image"):(0,t.jsx)(q,{}):(0,t.jsxs)("div",{className:"flex relative items-center justify-center w-full h-full",children:[(null==n?void 0:n.url)&&(0,t.jsxs)(t.Fragment,{children:[!c&&(0,t.jsx)(q,{className:"absolute z-20 inset-0"}),(0,t.jsx)(j.motion.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},exit:"hidden",animate:r&&i||!c?"hidden":"visible",transition:{ease:"easeInOut"},src:n.url,alt:"active-image",className:"max-h-full aspect-auto rounded-lg",onLoad:()=>d(!0)},"finished-image")]}),(0,t.jsx)(b.AnimatePresence,{children:!s&&r&&i&&(0,t.jsxs)(j.motion.div,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},initial:"hidden",exit:"hidden",animate:"visible",transition:{ease:"easeInOut"},className:"absolute z-10 w-full h-full flex items-center overflow-hidden",children:[!u&&(0,t.jsx)(q,{className:"absolute z-20 inset-0"}),(0,t.jsx)(j.motion.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},animate:u?"visible":"hidden",src:r,alt:"parent-image",className:"max-h-full aspect-auto mx-auto rounded-lg",onLoad:()=>m(!0)},"parent-image")]},"parent-image-container")})]})})})},q=e=>{let{className:s}=e;return(0,t.jsx)(j.motion.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{ease:"easeInOut"},className:(0,k.cn)("h-full w-full flex items-center justify-center animate-pulse-lg",s),children:(0,t.jsx)(G.ImageIcon,{size:60,strokeWidth:1.3,className:"opacity-30 rotate-[-10deg]"})},"loader")};var W=e.i(328788),V=e.i(967187),Y=e.i(773030),K=e.i(431533),Q=e.i(763578),X=e.i(659065),J=e.i(879085),Z=e.i(62912);let $=e=>{let{hasImage:s,onSend:a,isStreaming:i}=e,{editImagePresets:n}=(0,x.useEditImagePresets)(),r=(0,W.useMobileSize)(),{t:o}=(0,I.useTranslation)("image-editor"),[l,c]=(0,S.useState)(null),[d,u]=(0,S.useState)(null),m=(0,S.useMemo)(()=>i||!s,[i,s]),p=(0,S.useCallback)(e=>{c(t=>t===e?null:e)},[c]),g=(0,S.useCallback)(e=>{if(!i)return c(null),a(e.prompt,e.presetId)},[i,a]),h=(0,S.useCallback)(()=>{if(!i)return c(null),a("Make video","make-video")},[i,a]),f=(0,S.useCallback)(e=>{let t=document.querySelector('[data-preset-id="'.concat(e,'"]'));if(!t)return{};let s=t.getBoundingClientRect();return s.right+12+200>window.innerWidth?{left:s.left-200-12,top:s.top+(s.height-150)/2}:{left:s.right+12,top:s.top+(s.height-150)/2}},[]);return(0,S.useEffect)(()=>{if(!l||r)return void u(null);let e=()=>{let e=document.body.querySelector("[data-highlighted][data-preset-id]"),t=(null==e?void 0:e.getAttribute("data-preset-id"))||null;t&&u(t)};e();let t=new MutationObserver(e);return t.observe(document.body,{attributes:!0,attributeFilter:["data-highlighted"],subtree:!0}),()=>{t.disconnect()}},[l,r]),(0,t.jsxs)("div",{className:"@container flex w-full xs:justify-center justify-start items-center overflow-x-auto xs:overflow-visible gap-2 xs:gap-3 relative z-30 no-scrollbar",children:[(0,t.jsx)(j.motion.div,{variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},initial:"hidden",animate:"visible",transition:{duration:.15,ease:"easeInOut"},className:"bg-surface-base rounded-full",children:(0,t.jsxs)(Q.Button,{variant:"filledSecondary",size:"md",className:"flex items-center justify-start py-3 border border-border-l1 rounded-3xl hover:text-fg-primary",onClick:h,children:[(0,t.jsx)(Z.Play,{fill:"currentColor",strokeWidth:0,className:"size-4"}),o("button.make-video","Make video")]},"make-video")},"make-video-animation"),n.map((e,s)=>(0,t.jsx)(j.motion.div,{variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},initial:"hidden",animate:"visible",transition:{duration:.15,ease:"easeInOut",delay:.06*(s+1)},className:"bg-surface-base rounded-full",children:r?(0,t.jsxs)(X.Drawer,{open:e.category===l,onOpenChange:t=>{t?c(e.category):c(null)},children:[(0,t.jsx)(X.DrawerTrigger,{disabled:m,asChild:!0,children:(0,t.jsx)(ee,{category:e,disabled:m})}),(0,t.jsxs)(X.DrawerContent,{className:"max-h-[90dvh]",children:[(0,t.jsx)(X.DrawerHeader,{children:(0,t.jsxs)(X.DrawerTitle,{className:"flex items-center justify-center gap-2",children:[e.icon&&S.default.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),e.label]})}),(0,t.jsx)("div",{className:"p-2 space-y-2 overflow-auto",children:e.presets.map(e=>(0,t.jsxs)(Q.Button,{variant:"ghost",size:"lg",className:"w-full flex items-center justify-start gap-3 h-auto py-3",onClick:()=>g(e),children:[e.icon&&S.default.createElement(e.icon,{size:18,className:"text-secondary flex-shrink-0"}),(0,t.jsx)("span",{children:e.label})]},e.presetId))})]})]}):(0,t.jsxs)(J.DropdownMenu,{open:e.category===l,onOpenChange:()=>p(e.category),children:[(0,t.jsx)(J.DropdownMenuTrigger,{disabled:m,asChild:!0,children:(0,t.jsx)(ee,{category:e,disabled:m})}),(0,t.jsx)(J.DropdownMenuContent,{hideWhenDetached:!0,side:"top",sideOffset:8,className:"min-w-60 space-y-0.5 z-[100000]",onMouseLeave:()=>{u(null)},onWheel:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),children:e.presets.map(s=>(0,t.jsxs)(J.DropdownMenuItem,{"data-preset-id":s.presetId,className:"flex items-center gap-2",onSelect:()=>g(s),children:[s.icon&&S.default.createElement(s.icon,{size:16,className:"text-secondary flex-shrink-0"}),s.label,d===s.presetId&&(0,Y.createPortal)((0,t.jsxs)(j.motion.div,{layoutId:"preset-preview",className:"fixed w-[200px] h-[150px] bg-surface-l4 border border-border-l1 rounded-2xl shadow-lg z-50 pointer-events-none flex items-center justify-center p-1.5",style:f(s.presetId),children:[(0,t.jsx)(K.ImageLoader,{className:"absolute inset-0"}),s.previewUrl&&(0,t.jsx)(V.default,{src:s.previewUrl,alt:s.presetId,width:200,height:150,priority:!r&&l===e.category,className:"w-full h-full object-cover rounded-xl relative z-10"})]}),document.body)]},s.presetId))})]})},e.category))]})},ee=S.default.forwardRef((e,s)=>{let{category:a,disabled:i,...n}=e;return(0,t.jsxs)(Q.Button,{ref:s,size:"md",variant:"filledSecondary",rounded:!0,className:(0,k.cn)(!i&&"*:hover:text-primary transition-all"),disabled:i,...n,children:[a.icon&&S.default.createElement(a.icon,{size:16,className:"flex-shrink-0 text-secondary transition-colors"}),(0,t.jsx)("span",{children:a.label})]})});var et=e.i(8681),es=e.i(351958),ea=e.i(283272),ei=e.i(218946);let en=e=>{let{onUploadImage:s}=e,{t:a}=(0,I.useTranslation)("base"),i=(0,L.useFileStore)(B.prop("fetchUploadFile")),n=(0,L.useFileStore)(B.prop("removeByConversationId")),o=(0,r.useChatPageStore)(B.prop("conversationId")),{ASSET_SERVER_URL:c}=(0,l.useEnvironment)(),d=(0,ei.useRequestErrorToastFn)(),u=(0,S.useRef)(null),[m,p]=(0,S.useState)(!1),[g,h]=(0,S.useState)(!1),x=(0,S.useCallback)(()=>{var e;null==(e=u.current)||e.click()},[]),f=(0,S.useCallback)(async e=>{let t;if(1!==e.length||!e[0])return void F.toast.error(a("Only a single image file is allowed","Only a single image file is allowed"));if(!["image/png","image/jpeg","image/jpg","image/webp"].includes(e[0].type))return void F.toast.error(a("Only image files are allowed","Only image files are allowed"));h(!0);try{let s=i(e[0],o||"no_conversation_id");t=await s.metadataPromise}catch(e){d("image-editor-upload:uploadFile",e)}t instanceof Error&&d("image-editor-upload:uploadFile",t,a("Failed to upload file","Failed to upload file")),h(!1),n(o||"no_conversation_id"),!t||t instanceof Error||s({url:(0,R.getAssetUrl)(c,t.fileUri),metadata:t})},[a,i,o,s,c,n,d]),v=(0,S.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),g||p(!0)},[g]),y=(0,S.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),p(!1)},[]),N=(0,S.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),p(!1),!g)return f(Array.from(e.dataTransfer.files))},[f,g]),C=(0,S.useCallback)(e=>{if(e.target.files)return f(Array.from(e.target.files)).finally(()=>{u.current&&(u.current.value="")})},[f]);return(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},onDragOver:v,onDragLeave:y,onDrop:N,className:"border resize transition-colors w-full max-w-7xl h-full flex justify-center items-center border-border-l1 rounded-2xl p-8 mb-3 text-center ".concat(m&&!g&&"bg-surface-l1 border-border-l1"),children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"p-4 rounded-full text-fg-secondary transition-colors bg-surface-l1",children:(0,t.jsx)(b.AnimatePresence,{mode:"popLayout",children:m&&!g?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(et.Files,{className:"size-6"})},"files"):(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(es.ImagePlusIcon,{className:"size-6"})},"image-plus")})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-primary",children:a("Upload an image to begin","Upload an image to begin")}),(0,t.jsx)(b.AnimatePresence,{mode:"popLayout",children:g?(0,t.jsx)(j.motion.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:a("Uploading image","Uploading image")},"uploading"):m?(0,t.jsx)(j.motion.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:a("Drop image here","Drop image here")},"dragging"):(0,t.jsx)(j.motion.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:a("Drag and drop to upload","Drag and drop to upload")},"not-dragging")})]}),(0,t.jsx)("div",{className:"flex gap-3",children:(0,t.jsxs)(Q.Button,{variant:"outline",className:"text-fg-primary hover:bg-button-ghost-hover rounded-2xl transition-all py-2.5 px-4 h-auto *:hover:text-fg-primary *:hover:transition-colors",disabled:g,autoFocus:!0,onClick:x,children:[g?(0,t.jsx)(w.Spinner,{size:"xxs"}):(0,t.jsx)(ea.Upload,{className:"size-4 text-fg-secondary"}),a("Upload","Upload")]})}),(0,t.jsx)("input",{ref:u,className:"hidden",type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:C,multiple:!1,"data-testid":"file-input"})]})})};var er=e.i(420986);let eo=()=>{let{ASSET_SERVER_URL:e}=(0,l.useEnvironment)(),s=(0,P.useFeatureFlags)(),a=(0,A.useLogEvent)(),{t:i}=(0,I.useTranslation)("base"),n=(0,E.useMaybeRefreshAnonSession)(),{handleSendStart:c,timeToSendStart:d,consumeTimeToSendMs:u}=(0,D.useImageEditingMetrics)(),[m,p]=(0,_.useLocalStorage)("image-editor-first-open",!0),g=(0,O.useImageEditorStore)(B.prop("isOpen")),h=(0,O.useImageEditorStore)(B.prop("currentImage")),x=(0,O.useImageEditorStore)(B.prop("setImage")),f=(0,r.useChatPageStore)(B.prop("conversationId")),v=(0,r.useChatPageStore)(B.prop("streamedMessageId")),j=(0,r.useChatPageStore)(B.prop("lastMessageId")),w=(0,z.useResponseStore)(e=>e.byId[null!=v?v:""]),C=(0,z.useResponseStore)(B.prop("byId")),k=(0,S.useMemo)(()=>{var e;return null!=(e=z.useResponseStore.getState().byConversationId[null!=f?f:""])?e:[]},[f]),G=(0,er.useGenImagineVideoFromMediaUrl)(),[q,W]=(0,S.useState)(""),[V,Y]=(0,S.useState)(!1),[K,Q]=(0,S.useState)(null),[X,J]=(0,S.useState)(!1),[Z,ee]=(0,S.useState)(!1),[et,es]=(0,S.useState)(!1),[ea,ei]=(0,S.useState)(!1),[eo,el]=(0,S.useState)(!1),ec=(0,S.useMemo)(()=>!!h,[h]),ed=(0,S.useMemo)(()=>!!(h&&"key"in h),[h]),eu=(0,S.useMemo)(()=>!!(h&&"metadata"in h),[h]),em=(0,S.useMemo)(()=>{if(ed){if(V)return!K&&w&&Q(w.responseId),w||C[null!=K?K:""];let e=k.filter(e=>e.streamingImageById).find(e=>{for(let t in e.streamingImageById){let s=e.streamingImageById[t];if(!s)continue;let a=s[100];if((null==a?void 0:a.imageUrl)===(null==h?void 0:h.url))return!0}});return e||(null==k?void 0:k.find(e=>{var t,s;return null==(t=e.generatedImageUrls)?void 0:t.includes(null!=(s=h.assetKey)?s:"")}))}},[h,k,ed,V,w,K,C]),ep=(0,S.useMemo)(()=>(null==em?void 0:em.parentResponseId)?C[em.parentResponseId]:void 0,[em,C]),eg=(0,S.useMemo)(()=>ep?(0,R.getAssetUrl)(e,ep.imageEditUri):void 0,[ep,e]),eh=(0,S.useMemo)(()=>{if(eu){var t,s;return[{id:null!=(t=h.metadata.fileUri)?t:"",url:null!=(s=(0,R.getAssetUrl)(e,h.metadata.fileUri))?s:"",isModerated:!1,progressMap:void 0}]}return ed?em?V&&em.streamingImageById?Object.entries(em.streamingImageById).map(t=>{var s;let[a,i]=t,n=Object.keys(i).map(Number),r=i[Math.max(...n)];return{id:a,url:null!=(s=(0,R.getAssetUrl)(e,null==r?void 0:r.imageUrl))?s:"",isModerated:!1,progressMap:n.map(t=>{var s,a;return{progress:t/100,imageUrl:null!=(a=(0,R.getAssetUrl)(e,null==(s=i[t])?void 0:s.imageUrl))?a:""}})}}):em.generatedImageUrls.map(t=>{var s,a;let i=null!=(a=Object.values(null!=(s=em.streamingImageById)?s:{})[0])?a:{},n=Object.keys(i).map(Number);return{id:t,url:(0,R.getAssetUrl)(e,t),isModerated:!1,progressMap:n.length>0?n.map(t=>{var s,a;return{progress:t/100,imageUrl:null!=(a=(0,R.getAssetUrl)(e,null==(s=i[t])?void 0:s.imageUrl))?a:""}}):void 0}}):[]:[]},[h,em,ed,V,e,eu]),ex=(0,S.useMemo)(()=>eh.length>1?eh.find(e=>e.id===(null==h?void 0:h.key)||e.id===(null==h?void 0:h.assetKey)):eh[0],[eh,h]),ef=(0,S.useMemo)(()=>(0,t.jsx)(H,{isEditingCurrentImage:V,focusedImage:ex,parentImageUrl:ea?void 0:eg,isPeekingParent:X,setIsPeekingParent:J,generatedImageWidth:null==em?void 0:em.generatedImageWidth,generatedImageHeight:null==em?void 0:em.generatedImageHeight,isParentImageLoaded:et,isFinalImageLoaded:eo,setIsFinalImageLoaded:el,setIsParentImageLoaded:es}),[V,ex,X,eg,null==em?void 0:em.generatedImageWidth,null==em?void 0:em.generatedImageHeight,et,eo,ea]),ev=(0,S.useCallback)(()=>{(null==ex?void 0:ex.url)&&G(ex.url).catch(e=>{(0,y.logError)("image-editor:handleMakeVideo",e)})},[null==ex?void 0:ex.url,G]),ey=(0,S.useCallback)(e=>{e&&x(e)},[x]),eb=(0,S.useCallback)(e=>{let t=eh[e];t&&(V&&x({key:t.id}),x({key:t.id,assetKey:t.id,url:t.url,isModerated:t.isModerated,progress:(null==t?void 0:t.progressMap)?Math.max(...Object.keys(t.progressMap).map(Number)):1}))},[eh,V,x]),ej=(0,S.useCallback)(async e=>(ee(!0),e().finally(()=>{ee(!1)})),[]),eS=(0,o.useHandleAbort)("image-workbench:handleAbort",ej),eI=(0,S.useCallback)(async(e,t)=>{if(!e.trim()||!(null==h?void 0:h.url))throw Error("No message or image");let a=r.useChatPageStore.getState(),i=U.useSettingsStore.getState(),o=z.useResponseStore.getState(),l=L.useFileStore.getState(),c=t.replace(/^https?:\/\/[^/]+\/?/,"");W(""),l.removeByConversationId(a.conversationId||"no_conversation_id"),l.removeAttachByConversationId(a.conversationId||"no_conversation_id"),await n();let d=a.lastMessageId?o.byId[a.lastMessageId]:void 0;if(a.lastMessageId&&!d)throw Error("Last message is missing");if((null==d?void 0:d.sender)==="human")throw Error("Last message is human");"none"!==a.reasoningMode&&a.setReasoningMode("none");let u={message:e,toolOverrides:{imageGen:!0},imageEditUri:c,enableRetries:!0},m=eu&&h.metadata.fileMetadataId&&!(null==ep?void 0:ep.message)?[h.metadata.fileMetadataId]:[];if(eu)return a.conversationId?a.sendResponse({...u,parentResponseId:a.lastMessageId,conversationId:a.conversationId,fileAttachmentIds:m,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0,ff:s}):a.establishNewConversation({...u,fileAttachmentIds:[h.metadata.fileMetadataId],temporary:i.isIncognito,ff:s});if(!a.conversationId)throw Error("No conversation id");return a.sendResponse({...u,parentResponseId:a.lastMessageId,conversationId:a.conversationId,fileAttachmentIds:m,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0,ff:s})},[h,n,eu,ep,s]),ew=(0,S.useCallback)(async(e,t)=>{let s=r.useChatPageStore.getState(),a=z.useResponseStore.getState(),i=s.streamedMessageId?a.byId[s.streamedMessageId]:void 0;return["streaming","optimistic","reconnecting"].includes((null==i?void 0:i.state)||"closed")&&await eS(),Y(!0),eI(e,t).catch(()=>{O.useImageEditorStore.getState().close()})},[eI,eS]),eN=(0,S.useCallback)(async(e,t)=>{if(e.trim()&&(null==ex?void 0:ex.url))return(a("edit_image_start",(0,D.formatImageEditUri)(ex.url),{queryType:t?"preset":"manual",location:"image-editor",presetId:t||"",message:e,messageLength:String(e.length),timeToSendMs:String(u())}),"make-video"===t)?ev():ew(e,ex.url).catch(e=>{(0,y.logError)("image-viewer:ImageEditor:handleEditCurrentImage",e)})},[ew,ex,a,u,ev]),eC=(0,S.useCallback)(()=>{if((null==ep?void 0:ep.message)&&eg)return a("edit_image_start",(0,D.formatImageEditUri)(eg),{queryType:"regenerate",location:"image-editor",presetId:"",message:null==ep?void 0:ep.message,messageLength:String(null==ep?void 0:ep.message),timeToSendMs:String(u())}),ew(ep.message,eg).catch(e=>{(0,y.logError)("image-viewer:ImageEditor:handleRegenerate",e)})},[ep,eg,ew,a,u]);(0,S.useEffect)(()=>{V&&eh.length&&eh[0]&&!eh.find(e=>e.id===h.key)&&x({key:eh[0].id})},[eh,V,h,x]),(0,S.useEffect)(()=>{let t=O.useImageEditorStore.getState();if(V&&w&&"error"===w.state)return t.close();if(V&&K&&w&&"closed"===w.state){var s,i,n,r;if(Y(!1),Q(null),!j)return t.close();let o=C[j];if(!o)return t.close();let l=null==(n=o.streamingImageById)||null==(i=n[null!=(r=null==h?void 0:h.key)?r:""])||null==(s=i[100])?void 0:s.imageUrl;if(!l)return t.close();a("edit_image_end",(0,D.formatImageEditUri)((null==ep?void 0:ep.imageEditUri)||""),{location:"image-editor"}),x({key:l,assetKey:l,url:(0,R.getAssetUrl)(e,l),progress:100,isModerated:!1})}},[ep,w,V,K,j,C,e,a,x]),(0,S.useEffect)(()=>{V||Z||void 0!==d||c()},[u,c,V,Z,d]),(0,S.useEffect)(()=>{if(null==ex?void 0:ex.url){el(!1);let e=new Image;e.onload=()=>el(!0),e.src=ex.url}},[null==ex?void 0:ex.url]),(0,S.useEffect)(()=>{if(eg){es(!1),ei(!1);let e=new Image;e.onload=()=>es(!0),e.onerror=()=>ei(!0),e.src=eg}},[eg]),(0,S.useEffect)(()=>{m&&g&&(p(!1),F.toast.message((0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-fg-primary font-bold",children:i("image-editor-welcome.title","Welcome to Image Editor")}),(0,t.jsx)("p",{className:"text-fg-secondary",children:i("image-editor-welcome.description","A focused space for you to transform images with Grok to anything you can imagine.")})]}),{duration:7e3}))},[m,g,p,i]);let ek=(0,O.useImageEditorStore)(B.prop("close"));return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-between gap-6 sm:gap-20 w-full h-full",children:[(0,t.jsx)(N,{hasImage:ec,prompt:eg?null==ep?void 0:ep.message:void 0,focusedImageUrl:null==ex?void 0:ex.url,parentImageUrl:ea?void 0:eg,isStreaming:V||Z,onParentPeek:e=>J(e),onClose:ek,onRegenerate:eC}),ec?ef:g&&(0,t.jsx)(en,{onUploadImage:ey}),(0,t.jsx)("footer",{className:"relative w-full max-w-2xl h-16 flex-shrink-0 mt-12 sm:mt-0",children:(0,t.jsxs)("div",{className:"absolute bottom-0 inset-x-0 flex flex-col gap-4",children:[(0,t.jsx)(b.AnimatePresence,{mode:"popLayout",children:ec&&eh&&eh.length>1&&(0,t.jsx)(M,{isStreaming:V||Z,images:eh,focusedOption:eh.findIndex(e=>e.id===(null==ex?void 0:ex.id))||0,onSelect:eb})}),(0,t.jsx)($,{hasImage:ec,isStreaming:V||Z,onSend:eN}),(0,t.jsx)(T.ImageEditorQueryBar,{hasImage:ec,inputValue:q,isStreaming:V||Z,onInputValueChange:W,onSend:eN,onAbort:eS})]})})]})};var el=e.i(687712),ec=e.i(436562),ed=e.i(402423);let eu=()=>{let{t:e}=(0,I.useTranslation)("base"),s=(0,A.useLogEvent)(),a=(0,O.useImageEditorStore)(B.prop("isOpen")),i=(0,O.useImageEditorStore)(B.prop("close")),n=(0,r.useChatPageStore)(B.prop("conversationId")),[o,l]=(0,S.useState)(void 0),{handleEditorOpen:c,consumeEditorTimeMs:d,editorOpenTime:u}=(0,D.useImageEditingMetrics)();return(0,S.useEffect)(()=>{a&&void 0===u?c():a||void 0===u||s("image_editor_close",void 0,{timeInEditorMs:String(d()),location:"image-editor-dialog"})},[a,c,d,s,u]),(0,S.useEffect)(()=>{n!==o&&(o&&i(),l(n))},[n,i,o]),(0,t.jsx)(ec.Dialog,{open:a,onOpenChange:e=>{e||i()},children:(0,t.jsxs)(el.DialogPortal,{children:[(0,t.jsx)(ec.DialogOverlay,{className:"fixed inset-0 z-50 bg-overlay duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"}),(0,t.jsxs)(ec.DialogContent,{"aria-describedby":e("image-editor.title","Image editor"),className:(0,k.cn)("fixed z-50 inset-0 bg-background duration-200 focus:outline-none","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 p-2 lg:p-6"),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},children:[(0,t.jsx)(ed.VisuallyHidden,{children:(0,t.jsx)(el.DialogTitle,{children:e("image-editor.title","Image editor")})}),(0,t.jsx)(eo,{})]})]})})};var em=e.i(572848),ep=e.i(729009),eg=e.i(713087),eh=e.i(626205),ex=e.i(157695),ef=e.i(479268),ev=e.i(724499),ey=e.i(136783),eb=e.i(6880),ej=e.i(880020),eS=e.i(383293);e.i(31157);var eI=e.i(171686),ew=e.i(938270),eN=e.i(489843);e.s(["ImagineBanner",()=>eD],416872);var eC=e.i(584244),ek=e.i(539658),eM=e.i(81795),eT=e.i(926836),eE=e.i(10404);let eP=0;function eD(e){let{persistentBanner:s=!1}=e,{user:a}=(0,em.useSession)(),{os:i}=(0,eT.useOs)(),n=(0,A.useLogEvent)(),r=(0,W.useMobileSize)(),{push:o}=(0,ev.useRouting)(),[l,c]=(0,_.useLocalStorage)("visited-imagine2",!1),[d,u]=(0,_.useLocalStorage)("imagine-banner-impressions2",0);(0,S.useEffect)(()=>{!s&&(Date.now()<eP||(eP=Date.now()+12e4,u(e=>e+1)))},[]);let{resolvedTheme:p}=(0,eM.useTheme)(),g=(0,S.useCallback)(e=>{e.stopPropagation(),n("imagine_banner_clicked","imagine-banner",{location:"imagine-banner"}),o({page:"imagine"})},[o,n]),x=(0,S.useCallback)(e=>{e.stopPropagation(),c(!0),n("imagine_banner_dismissed","imagine-banner",{location:"imagine-banner"})},[c,n]);(0,S.useEffect)(()=>{n("imagine_banner_impression","imagine-banner",{location:"imagine-banner"})},[]);let f=new URLSearchParams({return_to:"/imagine"}).toString(),v=(0,S.useCallback)(e=>{e.stopPropagation(),n("imagine_banner_clicked","imagine-banner",{location:"imagine-banner"}),n("sign_up_redirect",i,{location:"imagine-banner",os:i})},[n,i]),y=(0,S.useCallback)(e=>{e.stopPropagation(),n("imagine_banner_clicked","imagine-banner",{location:"imagine-banner"}),n("sign_in_redirect",i,{location:"imagine-banner",os:i})},[n,i]),{t:b}=(0,I.useTranslation)("imagine");return(0,t.jsxs)("div",{className:(0,k.cn)("relative dark max-w-[480px] w-full m-10",{"m-0 mb-24 mx-2":r}),children:[(0,t.jsxs)("div",{className:(0,k.cn)("flex dark flex-col items-center justify-center w-full rounded-3xl overflow-hidden  cursor-pointer bg-surface-l1 ",{"border-2 border-color-surface-l1":"dark"===p}),onClick:g,children:[(0,t.jsx)("div",{className:"relative w-full h-[110px] overflow-hidden",children:(0,t.jsx)(V.default,{priority:!0,quality:50,src:"/imagine-banner2.jpg",alt:b("imagine.banner.image.alt","Imagine promo banner image"),fetchPriority:"high",loading:"eager",fill:!0,className:"object-cover"})}),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between px-4 pt-0 pb-3 w-full",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,t.jsx)("p",{className:"dark text-primary text-sm font-bold m-0 p-0",children:b("imagine.banner_upgrades.title","Grok Imagine Upgrades")}),(0,t.jsx)(eE.NotificationBlip,{variant:"sm"})]}),(0,t.jsx)("p",{className:"dark text-fg-secondary text-sm m-0 p-0 ",children:b("imagine.banner_upgrades.subtitle","Generate videos with built-in audio - plus enhanced lifelike motion and character consistency")})]}),a&&(0,t.jsx)(h.Button,{variant:"secondary",shape:"pill",size:"md",className:"dark font-bold text-primary",onClick:g,children:b("imagine.banner_upgrades.button","Try Now")})]}),!a&&(0,t.jsxs)("div",{className:"flex flex-row gap-4 items-start justify-start mb-3",children:[(0,t.jsx)(h.Button,{className:"font-semibold text-sm",variant:"primary",size:"sm",shape:"pill",onClick:v,asChild:!0,children:(0,t.jsxs)(ek.default,{href:"/sign-up?"+f,children:[(0,t.jsx)(eC.User,{size:14}),b("Sign up","Sign up")]})}),(0,t.jsx)(h.Button,{className:"font-semibold text-sm",variant:"secondary",size:"sm",shape:"pill",onClick:y,asChild:!0,children:(0,t.jsx)(ek.default,{href:"/sign-in?"+f,children:b("Sign in","Sign in")})})]})]}),!s&&(0,t.jsx)(h.Button,{variant:"tertiary",shape:"circle",size:"xs",className:"dark font-bold text-primary absolute -top-2 -end-2 bg-surface-l2 hover:bg-surface-l4",onClick:x,"aria-label":"Close",children:(0,t.jsx)(m.XIcon,{className:"size-4"})})]})}var e_=e.i(230433),eA=e.i(132841),eR=e.i(840580),eL=e.i(934652);let eO=e=>{let{height:s,width:a}=e,{i18n:i}=(0,I.useTranslation)("chat"),{isSuperGrokUser:r,isSuperGrokProUser:o}=(0,e_.useSubscriptions)(),{isSwitchingTeam:l}=(0,eL.useEnterprise)(),c=(0,eA.useIsActiveGrokBusinessSession)(),d=(0,U.useSettingsStore)(B.prop("selectedLanguage")),[u,m]=(0,S.useState)(0),p=(0,S.useMemo)(()=>d||i.languages.find(e=>e in eR.supportedLocaleToLanguage)||eR.globalLocale,[d,i.languages]),[g,h]=(0,S.useState)({isSuperGrokProUser:o,isSuperGrokUser:r,usingGrokBusiness:c});return(0,S.useEffect)(()=>{l||h(e=>(e.usingGrokBusiness!==c&&m(e=>e+1),{isSuperGrokProUser:o,isSuperGrokUser:r,usingGrokBusiness:c}))},[o,r,c,l,h]),(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:(0,t.jsx)(j.motion.div,{initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:g.usingGrokBusiness?(0,t.jsx)(n.BlackholeGrokBusinessLogo,{height:s,width:a}):g.isSuperGrokProUser?"ja"===p?(0,t.jsx)(n.SuperGrokHeavyJpLogo,{height:s,width:a}):(0,t.jsx)(n.SuperGrokHeavyLogo,{height:s,width:a}):g.isSuperGrokUser?"ja"===p?(0,t.jsx)(n.SuperGrokJpLogo,{height:s,width:a}):(0,t.jsx)(n.BlackholeSuperGrokLogo,{height:s,width:a}):"ja"===p?(0,t.jsx)(n.BlackholeGrokJpLogo,{height:s,width:a}):(0,t.jsx)(n.BlackholeGrokLogo,{height:s,width:a})},"logo-".concat(u))})};var ez=e.i(315302);e.i(866166);var eU=e.i(928325),eB=e.i(858649);let eF=e=>{let{className:s}=e,{t:a}=(0,I.useTranslation)("base"),i=(0,ei.useRequestErrorToastFn)(),{mutate:n,isPending:r}=(0,ez.useGetConnectorsAuthUrl)(),o=async()=>{r||n(eU.GrokApiConnectorType.ConnectorTypeGoogleDrive,{onSuccess:e=>{if(!e)throw Error("Failed to get auth url");window.location.href=e},onError:e=>{i("drive-oauth-card:handleConnect",e)}})};return(0,t.jsxs)(j.motion.div,{initial:{opacity:0,scale:.99},animate:{opacity:1,scale:1},transition:{duration:.1},className:(0,k.cn)(s,"bg-surface-l1 border border-border-l1 rounded-3xl flex items-center p-3 gap-3 w-full max-w-[560px] mx-auto"),children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(eB.GDriveIcon,{size:32})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-fg-primary font-semibold text-sm",children:a("connectors.drive-oauth.title","Connect to Google Drive")}),(0,t.jsx)("p",{className:"text-fg-secondary text-sm",children:a("connectors.drive-oauth.description","Enabled by your admin. Allow Grok to reference files when answering your questions.")})]}),(0,t.jsxs)(h.Button,{variant:"primary",size:"sm",shape:"pill",disabled:r,onClick:o,className:"relative",children:[(0,t.jsx)("div",{className:(0,k.cn)("opacity-100",{"opacity-0":r}),children:a("connectors.connect","Connect")}),(0,t.jsx)("div",{className:(0,k.cn)("absolute flex h-full w-full items-center justify-center opacity-0",{"opacity-100":r}),children:(0,t.jsx)(w.Spinner,{size:"xs"})})]})]},"gdrive-oauth-card")};var eG=e.i(540942);e.i(298616);var eH=e.i(910503),eq=e.i(364778),eW=e.i(749894),eV=e.i(944408),eY=e.i(432286),eK=e.i(738416);function eQ(e){return(0,eK.startOfDay)(Date.now(),e)}var eX=e.i(921127),eJ=e.i(119470),eZ=e.i(495794);function e$(e,t,s){return(0,eZ.addMonths)(e,-t,s)}var e0=function(e){return e.PAST_30_DAYS="past-30-days",e.THIS_MONTH="this-month",e.THIS_YEAR="this-year",e.PAST_3_MONTHS="past-3-months",e.PAST_6_MONTHS="past-6-months",e}({});let e1=e=>{let{isError:s,title:a,timeRangeOptions:i,selectedTimeRange:n,onTimeRangeChange:r,children:o}=e,{t:l}=(0,I.useTranslation)("base"),[c,d]=(0,S.useState)(!1),u=(0,S.useCallback)(e=>{switch(e){case"past-30-days":return l("team-insights.time-range.past-30-days","Past 30 days");case"this-month":return l("team-insights.time-range.this-month","This month");case"this-year":return l("team-insights.time-range.this-year","This year");case"past-3-months":return l("team-insights.time-range.past-3-months","Past 3 months");case"past-6-months":return l("team-insights.time-range.past-6-months","Past 6 months")}},[l]),m=(0,S.useMemo)(()=>u(n),[n,u]);return(0,t.jsxs)("div",{className:"h-full flex flex-col",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-xs text-fg-secondary",children:a}),(null==i?void 0:i.length)?(0,t.jsxs)(J.DropdownMenu,{open:c,onOpenChange:d,children:[(0,t.jsxs)(J.DropdownMenuTrigger,{className:"text-xs text-fg-tertiary flex items-center gap-1 focus:outline-none",children:[(0,t.jsx)("span",{className:"whitespace-nowrap",children:m}),(0,t.jsx)(eV.ChevronDownIcon,{className:(0,k.cn)("size-3 text-fg-tertiary transition-transform",{"rotate-180":c})})]}),(0,t.jsx)(J.DropdownMenuContent,{sideOffset:8,align:"end",className:"min-w-40",children:i.map(e=>(0,t.jsxs)(J.DropdownMenuItem,{onSelect:()=>null==r?void 0:r(e),className:"flex items-center gap-2 justify-between",children:[(0,t.jsx)("span",{children:u(e)}),e===n&&(0,t.jsx)(eW.CheckIcon,{className:"text-fg-primary size-4"})]},e))})]}):(0,t.jsx)("span",{className:"text-xs text-fg-tertiary",children:m})]}),(0,t.jsx)("div",{className:"flex flex-col justify-between mt-3 w-full h-12",children:s?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center items-center h-full border border-border-l1 rounded-2xl",children:(0,t.jsx)("span",{className:"text-fg-tertiary text-sm",children:l("team-insights.error-loading-data","Could not load data")})},"error"):o})]})},e2=e=>{switch(e){case"past-30-days":return(0,eJ.subDays)(eQ(),29).toISOString();case"this-month":return(0,eY.startOfMonth)(eQ()).toISOString();case"this-year":return(0,eX.startOfYear)(eQ()).toISOString();case"past-3-months":return(0,eY.startOfMonth)(e$(eQ(),2)).toISOString();case"past-6-months":return(0,eY.startOfMonth)(e$(eQ(),5)).toISOString()}};var e3=e.i(410289),e4=e.i(203857);let e6=()=>{let{t:e}=(0,I.useTranslation)("base"),{currentTeam:s,isSwitchingTeam:a}=(0,eL.useEnterprise)(),[i,n]=(0,_.useLocalStorage)("team-insights.messages-counters-time-range",e0.THIS_MONTH),r=(0,S.useMemo)(()=>e2(i),[i]),{data:o,isFetching:l,isError:c}=(0,eH.useQuery)({queryKey:["team-stats",null==s?void 0:s.teamId,r],queryFn:async()=>eq.grokForTeamsApi.grokForTeamsGetTeamStats({fromTime:r,maxEntries:3}),enabled:!!(null==s?void 0:s.teamId)&&!a,staleTime:1/0}),d=(0,S.useMemo)(()=>l||a,[l,a]),u=(0,e4.useDebouncedValue)(d,300,[d]),m=(0,S.useMemo)(()=>[{count:parseInt(u?"0":(null==o?void 0:o.messageCount)||"0"),label:e("team-insights.you","You")},{count:parseInt(u?"0":(null==o?void 0:o.totalMessages)||"0"),label:e("team-insights.team","Team")}],[o,e,u]);return(0,t.jsx)(e1,{title:e("team-insights.messages","Messages"),timeRangeOptions:[e0.THIS_MONTH,e0.PAST_3_MONTHS,e0.PAST_6_MONTHS,e0.THIS_YEAR],selectedTimeRange:i,onTimeRangeChange:e=>n(e),isError:c,children:m.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)("span",{className:"text-xs text-fg-secondary",children:e.label}),(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:d?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-6 flex items-center justify-end",children:(0,t.jsx)(e3.Skeleton,{className:(0,k.cn)("h-2 w-10 rounded-sm",{"w-20":1===s})})},"loading"):(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"h-6",children:(0,t.jsx)(eG.default,{value:e.count,className:"text-sm font-semibold"})},"count")})]},e.label))})},e5=()=>{let{t:e}=(0,I.useTranslation)("base"),{currentTeam:s,isSwitchingTeam:a}=(0,eL.useEnterprise)(),[i,n]=(0,_.useLocalStorage)("team-insights.sharing-leaderboard-time-range",e0.THIS_MONTH),r=(0,S.useMemo)(()=>e2(i),[i]),{data:o,isFetching:l,isError:c}=(0,eH.useQuery)({queryKey:["team-stats",null==s?void 0:s.teamId,r],queryFn:async()=>eq.grokForTeamsApi.grokForTeamsGetTeamStats({fromTime:r,maxEntries:3}),enabled:!!(null==s?void 0:s.teamId)&&!a,staleTime:1/0}),d=(0,S.useMemo)(()=>l||a,[l,a]),u=(0,S.useMemo)(()=>{var e,t;let s=Array.from({length:3}).map(()=>({name:" - ",shareLinkCount:0}));return[...(null==o||null==(t=o.topUsers)||null==(e=t.map(e=>{var t,s;return{name:"".concat(null==(t=e.user)?void 0:t.givenName," ").concat(null==(s=e.user)?void 0:s.familyName),shareLinkCount:parseInt(e.shareLinkCount||"0")}}))?void 0:e.sort((e,t)=>t.shareLinkCount-e.shareLinkCount))||[],...s].slice(0,3)},[o]);return(0,t.jsx)(e1,{title:e("team-insights.top-sharers","Top sharers"),timeRangeOptions:[e0.THIS_MONTH,e0.PAST_3_MONTHS,e0.PAST_6_MONTHS,e0.THIS_YEAR],selectedTimeRange:i,onTimeRangeChange:e=>n(e),isError:c,children:u.map((s,a)=>{let{name:i,shareLinkCount:n}=s;return(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 w-full h-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1 min-w-0",children:[(0,t.jsx)("span",{className:"text-fg-secondary text-[12px] w-3 text-start tabular-nums",children:a+1}),(0,t.jsx)(b.AnimatePresence,{initial:!1,mode:"wait",children:d?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(e3.Skeleton,{className:"h-2 w-20 rounded-sm"})},"loading"):(0,t.jsx)(j.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-fg-primary text-xs truncate",children:i},"name")})]}),(0,t.jsx)(b.AnimatePresence,{initial:!1,mode:"wait",children:d?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(e3.Skeleton,{className:"h-2 w-20 rounded-sm"})},"loading"):(0,t.jsx)(j.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-xs text-fg-tertiary whitespace-nowrap",children:e("team-insights.share-count","{{count}} shared",{count:n})},"count")})]},"".concat(a,"-").concat(i))})})};var e8=e.i(355524),e9=e.i(103882);e.i(406151);var e7=e.i(488842),te=function(e){return e[e.NONE=0]="NONE",e[e.LOW=1]="LOW",e[e.MEDIUM=2]="MEDIUM",e[e.HIGH=3]="HIGH",e[e.VERY_HIGH=4]="VERY_HIGH",e}(te||{});let tt=()=>{let{t:e}=(0,I.useTranslation)("base"),{resolvedTheme:s}=(0,eM.useTheme)(),{currentTeam:a,isSwitchingTeam:i}=(0,eL.useEnterprise)(),n=(0,S.useMemo)(()=>e2(e0.PAST_30_DAYS),[]),{data:r,isLoading:o,isError:l}=(0,eH.useQuery)({queryKey:["team-stats",null==a?void 0:a.teamId,n],queryFn:async()=>eq.grokForTeamsApi.grokForTeamsGetTeamStats({fromTime:n,maxEntries:3}),enabled:!!(null==a?void 0:a.teamId)&&!i,staleTime:1/0}),c=(0,S.useMemo)(()=>{let e=Array.from({length:30}).map((e,t)=>{var s,a,i;let o=new Date(n);return o.setDate(o.getDate()+t),parseInt((null==r||null==(i=r.teamStats)||null==(a=i.stats)||null==(s=a.find(e=>e.startTime&&(0,e9.isSameDay)(e.startTime,o)))?void 0:s.totalMessages)||"0")}),t=e.filter(e=>e>0),s=[0,1,20,50];if(t.length>0){let e=[...t].sort((e,t)=>e-t),a=e[Math.floor(.25*e.length)]||1;s=[0,a,e[Math.floor(.5*e.length)]||1,e[Math.floor(.75*e.length)]||1]}return Array.from({length:30}).map((t,a)=>{let i=new Date(n);i.setDate(i.getDate()+a);let r=e[a]||0,o=0===r?0:r<=s[1]?1:r<=s[2]?2:r<=s[3]?3:4;return{date:i.toISOString(),totalMessages:r,colorLevel:o}})},[n,r]),d=(0,S.useMemo)(()=>o||i,[o,i]);return(0,t.jsx)(e1,{title:e("team-insights.team-usage","Team usage"),selectedTimeRange:e0.PAST_30_DAYS,isError:l,children:(0,t.jsx)("div",{className:"grid grid-cols-12 content-between w-full h-full max-w-[260px] place-items-stretch",children:c.map((a,i)=>(0,t.jsxs)(e8.Tooltip,{disableHoverableContent:!0,delayDuration:0,children:[(0,t.jsx)(e8.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("div",{className:(0,k.cn)("group w-full h-full flex items-center justify-center"),children:(0,t.jsx)("div",{className:(0,k.cn)("duration-200 transition-all",{"group-hover:scale-125":!d}),children:(0,t.jsx)("div",{className:(0,k.cn)("w-3 h-3 border border-border-l1 rounded-[4px] transition-all duration-500",{"animate-pulse":d}),style:{backgroundColor:ts[s||"dark"][d?0:a.colorLevel],animationDelay:"".concat(.03*i,"s"),animationDuration:"1s"}})})})}),!d&&(0,t.jsx)(e8.TooltipContent,{children:(0,t.jsx)("span",{className:"text-xs",children:a.totalMessages?e("team-insights.day-with-activity","{{count}} messages on {{date}}",{date:(0,e7.format)(a.date,"MMMM do"),count:a.totalMessages}):e("team-insights.day-without-activity","No activity on {{date}}",{date:(0,e7.format)(a.date,"MMMM do")})})})]},a.date))})})},ts={dark:{0:"#1D1E20",1:"#242628",2:"#3E3F41",3:"#57595B",4:"#B5B5B5"},light:{0:"#F3F3F1",1:"#BFBEBD",2:"#9F9E9D",3:"#646362",4:"#4B4A48"}};var ta=e.i(997339),ti=e.i(517176),tn=e.i(168413);function tr(e){let{children:s,isValidProp:a,...i}=e;a&&(0,ti.loadExternalIsValidProp)(a),(i={...(0,S.useContext)(ta.MotionConfigContext),...i}).isStatic=(0,tn.useConstant)(()=>i.isStatic);let n=(0,S.useMemo)(()=>i,[JSON.stringify(i.transition),i.transformPagePoint,i.reducedMotion]);return(0,t.jsx)(ta.MotionConfigContext.Provider,{value:n,children:s})}let to=e=>{let{className:s}=e;return(0,t.jsx)(tr,{transition:{duration:.2,ease:"easeInOut"},children:(0,t.jsx)("div",{className:(0,k.cn)("@container/team-insights w-full",s),children:(0,t.jsxs)("div",{className:"grid grid-cols-1 @[500px]/team-insights:grid-cols-2 @[700px]/team-insights:grid-cols-3 w-full",children:[(0,t.jsx)("div",{className:"hidden @[500px]/team-insights:block pl-4 pr-6",children:(0,t.jsx)(tt,{})}),(0,t.jsxs)("div",{className:"hidden @[700px]/team-insights:block px-6 relative",children:[(0,t.jsx)(e6,{}),(0,t.jsx)("div",{className:"hidden @[500px]/team-insights:block absolute left-0 inset-y-1 border-l border-border-l1"})]}),(0,t.jsxs)("div",{className:"pr-4 pl-6 relative",children:[(0,t.jsx)(e5,{}),(0,t.jsx)("div",{className:"hidden @[500px]/team-insights:block absolute left-0 inset-y-1 border-l border-border-l1"})]})]})})})};var tl=e.i(407725),tc=e.i(815628),td=e.i(229439),tu=e.i(373882),tm=e.i(952447);let tp=(0,p.default)("UserRoundSearch",[["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M2 21a8 8 0 0 1 10.434-7.62",key:"1yezr2"}],["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["path",{d:"m22 22-1.9-1.9",key:"1e5ubv"}]]);var tg=e.i(798554);let th=()=>({presets:tx}),tx=[{icon:tm.MessageCircleIcon,name:"Meeting Summary",description:"Summarize meeting transcripts into clear, actionable notes",systemPrompt:"You are a meeting notes assistant. Summarize the transcript into:\n- Decisions (what was agreed)\n- Action Items (with owners & deadlines)\n- Discussion Highlights (key topics covered).",inputGuidance:"Paste or upload the meeting transcript"},{icon:tp,name:"Candidate Evaluation",description:"Create a structured assessment of a candidate’s fit for a role",systemPrompt:"You are an HR assistant. Compare the CV against the job description. Write a structured report with:\n- Green Flags (strengths)\n- Red Flags (concerns)\n- Summary (overall impression)\n- Fit Score (1–10 with rationale).",inputGuidance:"Upload the candidate’s CV and paste the job description"},{icon:tu.LanguagesIcon,name:"Translate",description:"Translate English text into multiple languages",systemPrompt:"You are a professional translator. Translate the provided English text into: Chinese, Spanish, Hindi, Portuguese, Bengali, Russian, and Japanese. For each language, provide 3 natural variations that preserve the meaning and tone.",inputGuidance:"Paste English text you want to translate"},{icon:tg.Wrench,name:"Incident Report Draft",description:"Turn raw incident notes into a standardized postmortem draft",systemPrompt:"You are an SRE incident analyst. Write a postmortem report with:\n- Summary\n- Impact\n- Root Cause\n- Timeline of Events\n- Remediation / Prevention steps.",inputGuidance:"Upload incident notes, logs, or a timeline of events"}];var tf=e.i(969286),tv=e.i(154580),ty=e.i(194693),tb=e.i(840116);let tj=e=>{let{className:s}=e,{t:a}=(0,I.useTranslation)("base"),{push:i}=(0,ev.useRouting)(),n=(0,tv.useQueryClient)(),{shouldShow:r,dismiss:o}=(0,ty.useTourGuideTooltip)({tooltipId:"templates"}),[l,c]=(0,S.useState)(!1),[d,u]=(0,_.useLocalStorage)("landing-page-templates.order-by","usageCount"),{results:m,isError:p,isLoading:g}=(0,tl.useListConversationTemplates)({orderBy:d,sharedWithMe:!1,pageSize:4}),{presets:x}=th(),{mutate:f,isPending:v}=(0,tf.useMutation)({mutationFn:e=>eq.grokForTeamsApi.grokForTeamsTemplatesCreateTemplate({body:e})}),y=(0,S.useCallback)(e=>{let{templateName:t,templateDescription:s,inputGuidance:r,systemPrompt:l,assets:c,redirect:d}=e;if(!v)return o(),f({templateName:t||"",templateDescription:s||"",inputGuidance:r||"",systemPrompt:l||"",assets:c||[],sharedWithTeam:!1},{onSuccess:e=>{let{template:t}=e;if(t&&t.templateId)return"start-conversation"===d?i({page:"main",templateId:t.templateId}):"template-form"===d&&i({page:"templates",tab:"personal",templateId:t.templateId}),n.invalidateQueries({queryKey:(0,tl.getConversationTemplatesQueryKey)({})})},onError:()=>{F.toast.error(a("templates.failed-to-create-template","Failed to create template"))}})},[i,f,n,a,v,o]);return(0,t.jsx)(tr,{transition:{duration:.2,ease:"easeInOut"},children:(0,t.jsxs)("div",{className:(0,k.cn)("@container/template-widget w-full",s),children:[(0,t.jsxs)("div",{className:"px-4 flex justify-between items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex items-baseline gap-2.5",children:[(0,t.jsx)(tb.TourGuideBubble,{shouldShow:r,onDismiss:o,title:a("templates.guide-tooltip.title","Templates"),description:a("templates.guide-tooltip.description","Use templates to turn prompts into reusable starting points, making recurring tasks faster and more consistent."),badgeText:a("templates.guide-tooltip.new","new"),tooltipContentProps:{side:"right",sideOffset:4},children:(0,t.jsx)("div",{className:"text-base font-semibold text-fg-primary",children:a("templates.title","Templates")})}),(0,t.jsxs)(J.DropdownMenu,{open:l,onOpenChange:c,children:[(0,t.jsx)(J.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)("button",{className:"text-sm text-fg-tertiary flex items-center gap-1 focus:outline-none cursor-pointer focus:ring-1 ring-primary pl-1.5 p-1 -my-1 -ml-1.5 rounded-lg",children:[(0,t.jsx)("span",{className:"whitespace-nowrap",children:"createTime"===d?a("templates.order-by.create-time","Most recent"):a("templates.order-by.usage-count","Most used")}),(0,t.jsx)(eV.ChevronDownIcon,{className:(0,k.cn)("size-3.5 text-fg-tertiary transition-transform",{"rotate-180":l})})]})}),(0,t.jsxs)(J.DropdownMenuContent,{sideOffset:8,side:"bottom",align:"end",className:"min-w-40",children:[(0,t.jsxs)(J.DropdownMenuItem,{onSelect:()=>u("createTime"),className:"flex items-center gap-2 justify-between",children:[(0,t.jsx)("span",{children:a("templates.order-by.create-time","Most recent")}),"createTime"===d&&(0,t.jsx)(eW.CheckIcon,{className:"text-fg-primary size-4"})]},"createTime"),(0,t.jsxs)(J.DropdownMenuItem,{onSelect:()=>u("usageCount"),className:"flex items-center gap-2 justify-between",children:[(0,t.jsx)("span",{children:a("templates.order-by.usage-count","Most used")}),"usageCount"===d&&(0,t.jsx)(eW.CheckIcon,{className:"text-fg-primary size-4"})]},"usageCount")]})]})]}),(0,t.jsx)(ev.Link,{onClick:o,route:{page:"templates",tab:"personal"},className:"text-sm text-fg-tertiary font-semibold hover:text-fg-secondary transition-all outline-none focus:ring-1 ring-primary rounded-lg px-2 py-1 -m-2",children:a("templates.see-all","See all")})]}),p?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center items-center mx-4 py-6 mt-4 border border-border-l1 rounded-2xl",children:(0,t.jsx)("span",{className:"text-fg-tertiary text-sm",children:a("templates.failed-to-load","Failed to load templates")})},"error"):g||m.length?(0,t.jsx)("div",{className:"px-4 mt-4 grid grid-cols-2 w-full gap-4",children:(0,t.jsx)(b.AnimatePresence,{initial:!1,children:Array.from({length:4}).map((e,s)=>{let a=m[s];return(0,t.jsx)(tS,{template:a,isLoading:g,onCustomTemplateSelect:()=>y({redirect:"template-form"}),onPresetTemplateSelect:e=>y({templateName:e.templateName,templateDescription:e.templateDescription,inputGuidance:e.inputGuidance,systemPrompt:e.systemPrompt,redirect:"template-form"})},"template-".concat(s))})})}):(0,t.jsxs)("div",{className:"rounded-2xl border border-border-l1 flex flex-col justify-center items-center gap-4 p-6 mt-4",children:[(0,t.jsx)("div",{className:"text-sm text-fg-secondary font-semibold",children:a("templates.try-preset-templates","Try these templates")}),(0,t.jsxs)("div",{className:"flex items-center justify-center flex-wrap gap-3 max-w-lg",children:[x.slice(0,4).map(e=>(0,t.jsx)("div",{onClick:()=>y({templateName:e.name,templateDescription:e.description,inputGuidance:e.inputGuidance,systemPrompt:e.systemPrompt,redirect:"start-conversation"}),className:"px-3 py-1.5 rounded-full bg-surface-l1 border border-border-l1 hover:bg-surface-l2 transition-colors cursor-pointer",children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("div",{children:(0,t.jsx)(e.icon,{size:16,className:"text-fg-secondary"})}),(0,t.jsx)("span",{className:"text-fg-primary font-semibold text-sm truncate",children:e.name})]})},e.name)),(0,t.jsxs)(h.Button,{variant:"secondary",size:"sm",shape:"pill",onClick:()=>y({redirect:"template-form"}),children:[(0,t.jsx)(td.Plus,{size:18,className:"-ml-0.5"}),a("templates.add-new","Add")]})]})]})]})})},tS=e=>{let{template:s,isLoading:a,onCustomTemplateSelect:i,onPresetTemplateSelect:n}=e,{t:r}=(0,I.useTranslation)("base"),{presets:o}=th(),[l,c]=(0,S.useState)(!1),{startConversationWithTemplate:d}=(0,tc.useConversationTemplate)({templateId:(null==s?void 0:s.templateId)||null}),u=(0,S.useMemo)(()=>!a&&!s,[a,s]),m=(0,S.useCallback)(e=>{u&&c(e)},[u]),p=(0,S.useCallback)(()=>{s&&!a&&d()},[s,a,d]);return(0,t.jsxs)(J.DropdownMenu,{open:l,onOpenChange:m,children:[(0,t.jsx)(J.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(j.motion.button,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:p,className:(0,k.cn)("group p-3 flex flex-col bg-surface-l1 border border-border-l1 rounded-2xl transition-colors relative outline-none focus:ring-1 ring-primary",{"cursor-pointer hover:bg-surface-l2":!a,"bg-transparent":u,"bg-surface-l2":l}),children:[(0,t.jsx)("div",{className:"h-5 flex items-center min-w-0",children:(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:a?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(e3.Skeleton,{className:"h-3 w-40 rounded-sm"})},"loading-name"):s&&(0,t.jsx)(j.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-primary font-semibold truncate",children:s.templateName||r("templates.values.name.placeholder","New Template")},"title")})}),(0,t.jsx)("div",{className:"h-5 flex items-center min-w-0 ",children:(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:a?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(e3.Skeleton,{className:"h-3 w-24 rounded-sm"})},"loading-description"):s&&(0,t.jsx)(j.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-fg-secondary text-sm truncate",children:s.templateDescription||r("templates.values.description.placeholder","Description")},"description")})}),(0,t.jsx)(b.AnimatePresence,{initial:!1,children:u&&(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:(0,k.cn)("absolute inset-0 flex justify-center items-center"),children:(0,t.jsx)(td.Plus,{size:20,className:(0,k.cn)("opacity-25 group-hover:opacity-50 transition-opacity",{"opacity-50":l})})},"empty-state")}),u&&(0,t.jsx)("span",{className:"sr-only",children:r("templates.values.name.placeholder","New Template")})]})}),u&&(0,t.jsxs)(J.DropdownMenuContent,{align:"end",sideOffset:8,children:[(0,t.jsxs)(J.DropdownMenuItem,{className:"flex items-center gap-2",onSelect:i,children:[(0,t.jsx)(td.Plus,{size:16,className:"text-secondary flex-shrink-0"}),(0,t.jsx)("p",{children:r("templates.custom-template","Custom Template")})]}),o.map(e=>(0,t.jsxs)(J.DropdownMenuItem,{className:"flex items-center gap-2",onSelect:()=>null==n?void 0:n({templateName:e.name,templateDescription:e.description,inputGuidance:e.inputGuidance,systemPrompt:e.systemPrompt}),children:[(0,t.jsx)(e.icon,{size:16,className:"text-secondary flex-shrink-0"}),(0,t.jsx)("p",{children:e.name})]},e.name))]})]})};var tI=e.i(826921),tw=e.i(655890),tN=e.i(493845),tC=e.i(235289),tk=e.i(798045),tM=e.i(660168),tT=e.i(243634),tE=e.i(334172),tP=e.i(805546);let tD={7:"grok-4-mini-thinking-tahoe"};var t_=e.i(369699),tA=e.i(258722);e.i(49854);var tR=e.i(304902),tL=e.i(785239),tO=e.i(446583),tz=e.i(298438),tU=e.i(775175),tB=e.i(164221);e.i(916390);var tF=e.i(297473),tG=e.i(137278);function tH(){let e=(0,A.useLogEvent)(),s=(0,r.useChatPageStore)(e=>e.projectId),a=(0,r.useChatPageStore)(e=>e.setProjectId),i=(0,tG.useWorkspaceStore)(e=>e.ensureWorkspace),{t:n}=(0,I.useTranslation)("base");(0,S.useEffect)(()=>{i(tA.DEEP_SEARCH_PROJECT_ID)},[i]);let o=(0,S.useCallback)(()=>{e("deepsearch_pill_clicked",void 0,{location:"deepsearch-suggestion-pill",target:"chip"}),a(s===tA.DEEP_SEARCH_PROJECT_ID?void 0:tA.DEEP_SEARCH_PROJECT_ID)},[e,s,a]);return(0,t.jsxs)(h.Button,{variant:"secondary",size:"md",shape:"pill",onClick:o,children:[(0,t.jsx)(tF.DeepSearchIcon,{size:16,strokeWidth:2,className:"text-secondary"}),n("deep-search","DeepSearch")]})}var tq=e.i(979566),tW=e.i(7390),tV=e.i(567488),tY=e.i(338363);function tK(){let{exampleProjects:e}=(0,tV.useExampleProjects)(),{t:s}=(0,I.useTranslation)("base"),[a,i]=(0,S.useState)(!1),n=(0,ev.useRouting)(),r=function(){let{t:e}=(0,I.useTranslation)("base"),t=(0,P.useFeatureFlags)();return(0,S.useMemo)(()=>{switch(t.TRY_PROJECTS_NAME.value){case"explore-grok":return e("explore-grok","Explore Grok");case"try-demos":return e("try-demos","Try Demos");case"pick-personas":return e("pick-personas","Pick Personas");case"browse-ais":return e("browse-ais","Browse AIs");default:return e("try-projects","Try Projects")}},[t.TRY_PROJECTS_NAME.value,e])}(),o=(0,S.useCallback)(e=>{i(e)},[]),l=(0,S.useCallback)(e=>{i(!1),n.push({page:"workspace",workspaceId:e.workspaceId})},[n]),c=(0,S.useCallback)(()=>{tG.useWorkspaceStore.getState().setCreateDialogIsOpen(!0)},[]),d=(0,S.useCallback)(()=>{n.push({page:"workspaces"})},[n]);return(0,t.jsxs)(J.DropdownMenu,{open:a,onOpenChange:o,children:[(0,t.jsx)(J.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(h.Button,{variant:"secondary",size:"md",shape:"pill",children:[(0,t.jsx)(tq.FolderIcon,{size:16,strokeWidth:2,className:"text-secondary"}),r,(0,t.jsx)(eV.ChevronDownIcon,{size:12,strokeWidth:2,className:(0,k.cn)("text-secondary transition-transform duration-200",{"rotate-180":a})})]})}),(0,t.jsxs)(J.DropdownMenuContent,{children:[e.map(e=>(0,t.jsxs)(J.DropdownMenuItem,{className:"flex items-center gap-2",onClick:()=>l(e),children:[(0,t.jsx)(tY.WorkspaceIconView,{icon:e.icon}),(0,t.jsx)("p",{children:e.title})]},e.workspaceId)),(0,t.jsxs)(J.DropdownMenuItem,{onClick:c,children:[(0,t.jsx)(tW.PlusIcon,{size:16,className:"me-2 text-secondary"}),s("create-project","Create Project")]}),(0,t.jsxs)(J.DropdownMenuItem,{onClick:d,children:[(0,t.jsx)(tq.FolderIcon,{size:16,className:"me-2 text-secondary"}),s("view-all-projects","View All Projects")]})]})]})}var tQ=e.i(745322);function tX(e){let{handleSend:s}=e,a=(0,P.useFeatureFlags)(),{data:{enableImagine:i}={}}=(0,tQ.useFeatureControls)(),n=(0,U.useSettingsStore)(B.prop("isIncognito")),{exampleProjects:r}=(0,tV.useExampleProjects)(),o=a.EXAMPLE_PROJECTS_SUGGESTION_PILL&&r.length>0,l=a.ENABLE_VOICE_MODE;return(0,t.jsx)("div",{className:"flex flex-col gap-2",children:(0,t.jsxs)("div",{className:"flex flex-row flex-wrap w-full gap-2 @sm:gap-2 justify-center items-center",children:[(0,t.jsx)(tH,{}),i&&(0,t.jsx)(tJ,{}),!n&&!1,o?(0,t.jsx)(tK,{}):(0,t.jsx)(tN.LatestNewsPersona,{handleSend:s}),l?(0,t.jsx)(tZ,{}):(0,t.jsx)(tN.PersonaPills,{handleSend:s})]})})}function tJ(){let{push:e}=(0,ev.useRouting)(),{t:s}=(0,I.useTranslation)("base");return(0,t.jsxs)(h.Button,{size:"md",variant:"secondary",shape:"pill",onClick:()=>{e({page:"imagine"})},children:[(0,t.jsx)(es.ImagePlusIcon,{size:16,strokeWidth:2,className:"text-secondary"}),s("create-image","Create Image")]})}function tZ(){let{t:e}=(0,I.useTranslation)("chat"),{handleVoiceModeEnter:s}=(0,tk.useVoiceMode)({location:"voice-mode-pill"});return(0,t.jsxs)(h.Button,{size:"md",variant:"secondary",shape:"pill",onClick:s,children:[(0,t.jsx)(tB.AudioLinesIcon,{size:16,strokeWidth:2,className:"text-secondary"}),e("voice-mode-pill.label","Voice")]})}var t$=e.i(257239);let t0=(0,p.default)("AlarmClockCheck",[["circle",{cx:"12",cy:"13",r:"8",key:"3y4lt7"}],["path",{d:"M5 3 2 6",key:"18tl5t"}],["path",{d:"m22 6-3-3",key:"1opdir"}],["path",{d:"M6.38 18.7 4 21",key:"17xu3x"}],["path",{d:"M17.64 18.67 20 21",key:"kv2oe2"}],["path",{d:"m9 13 2 2 4-4",key:"6343dt"}]]);var t1=e.i(390864),t2=e.i(417508),t3=e.i(934290);let t4=e=>{let{onHide:s}=e,a=(0,A.useLogEvent)(),i=(0,W.useMobileSize)(),{t:n}=(0,I.useTranslation)("tasks"),{taskPresets:r}=(0,t$.useTaskPresets)(),o=(0,tL.useTasksStore)(B.prop("setCreateDialogIsOpen")),l=(0,tL.useTasksStore)(B.prop("setTaskToEdit")),[c,d]=(0,S.useState)(t5(r)[0]),u=(0,S.useCallback)(()=>{a("task_preset_clicked",void 0,{location:"PresetTaskPill"}),o(!0),l(c)},[c,o,l,a]),m=(0,S.useCallback)(e=>{a("task_preset_clicked",void 0,{location:"PresetTaskPill"}),o(!0),l(e),d(e)},[o,l,a]);return c?(0,t.jsxs)("div",{className:"flex items-center gap-2 w-full justify-center",children:[(0,t.jsxs)("div",{className:(0,k.cn)("rounded-3xl p-3 bg-surface-l1 border text-xs flex items-center justify-between",{"min-w-[500px]":!i}),children:[(0,t.jsx)(t6,{value:c,onValueChange:m}),(0,t.jsxs)(Q.Button,{variant:"filledSecondary",size:"sm",rounded:!0,onClick:u,className:"font-semibold",children:[(0,t.jsx)(t0,{size:14}),i?n("create-custom-task-dialog.schedule-task-short","Schedule"):n("create-custom-task-dialog.schedule-task","Schedule Task")]})]}),(0,t.jsx)(Q.ButtonWithTooltip,{tooltipContent:(0,t.jsx)("p",{children:n("create-custom-task-dialog.schedule-task-hide","Hide")}),tooltipContentProps:{side:"bottom"},variant:"filledSecondary",size:"iconMd",rounded:!0,"aria-label":n("create-custom-task-dialog.schedule-task-hide","Hide"),onClick:s,children:(0,t.jsx)(t3.X,{size:14})})]}):null};function t6(e){let{value:s,onValueChange:a}=e,[i,n]=(0,S.useState)(!1),{taskPresets:r}=(0,t$.useTaskPresets)(),{t:o}=(0,I.useTranslation)("tasks"),l=(0,W.useMobileSize)(),c=(0,S.useCallback)(e=>{n(e)},[]);return(0,t.jsxs)(J.DropdownMenu,{open:i,onOpenChange:c,children:[(0,t.jsx)(J.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(Q.Button,{className:"flex items-center font-semibold",variant:"text","aria-label":o("selected-day.label","Selected day"),size:"sm",children:[s.cta||s.name,(0,t.jsx)(t1.ChevronDown,{size:14,className:(0,k.cn)("transition-transform duration-200",{"rotate-180":i})})]})}),(0,t.jsx)(J.DropdownMenuContent,{side:"bottom",align:"start",sideOffset:20,alignOffset:-12,className:(0,k.cn)({"w-[500px]":!l}),children:t5(r).map(e=>(0,t.jsxs)(J.DropdownMenuItem,{onSelect:()=>{a(e)},className:"group flex items-center justify-between gap-2",children:[e.name,(0,t.jsx)(t2.ChevronRight,{size:14,className:"opacity-0 group-hover:opacity-100"})]},e.name))})]})}function t5(e){for(let t=e.length-1;t>0;t--){let s=Math.floor(Math.random()*(t+1)),a=e[t],i=e[s];if(void 0===a||void 0===i)throw Error("shuffleArray: Unexpected undefined value");e[t]=i,e[s]=a}return e}var t8=e.i(389052),t9=e.i(892621),t7=e.i(676452),se=e.i(398459),st=e.i(935347);function ss(e){let{scrollContainerRef:s}=e,{t:a}=(0,I.useTranslation)("chat"),i=(0,tA.useRoutingStore)(e=>e.push),n=(0,t7.useHighlightsStore)(e=>e.stories),r=(0,t7.useHighlightsStore)(e=>e.isLoading),o=(0,t7.useHighlightsStore)(e=>e.hasAnimated),l=(0,S.useRef)(!1),c=(0,S.useRef)(null),d=(0,S.useRef)(!o),u=(0,S.useCallback)(e=>{c.current&&c.current.disconnect(),e&&(c.current=new IntersectionObserver(e=>{let[t]=e;if(!t)return;let s=t7.useHighlightsStore.getState();t.isIntersecting&&!l.current&&s.nextCursor&&!s.isLoading&&(l.current=!0,s.fetchMoreStories().catch((0,y.createLogError)("highlights-stories-list:loadMore")).finally(()=>{l.current=!1}))},{threshold:0}),c.current.observe(e))},[]);(0,S.useEffect)(()=>()=>{c.current&&c.current.disconnect()},[]);let m=(0,S.useCallback)(e=>{s.current&&tA.useRoutingStore.getState().saveMainPageScrollPosition(s.current.scrollTop),i({page:"highlights",storyId:e})},[i,s]);return 0===n.length?null:(0,t.jsxs)("div",{className:(0,k.cn)("w-full relative",tC.QUERY_BAR_MAX_WIDTH_CLASS),children:[(0,t.jsxs)("button",{onClick:()=>i({page:"highlights"}),className:(0,k.cn)("flex items-center justify-between w-full px-3 py-1.5","text-left rounded-xl","mb-0"),disabled:!0,children:[(0,t.jsxs)("h2",{className:"text-primary font-semibold text-base flex items-center gap-1 m-0",children:[(0,t.jsx)(st.FlameIcon,{className:"size-5 text-secondary"}),a("For You","For You")]}),!1]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2 w-full pb-2",children:[d.current?(0,t.jsx)(b.AnimatePresence,{children:n.map((e,s)=>(0,t.jsx)(j.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},onAnimationComplete:()=>{s===n.length-1&&t7.useHighlightsStore.getState().setHasAnimated(!0)},children:(0,t.jsx)(se.HighlightsStoryRow,{story:e,borderless:!0,onClick:m,mode:"authors"},e.storyId)},e.storyId))}):n.map(e=>(0,t.jsx)(se.HighlightsStoryRow,{story:e,borderless:!0,onClick:m,mode:"authors"},e.storyId)),(0,t.jsx)("div",{ref:u,className:"absolute bottom-[200px] w-full h-1"}),r&&(0,t.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,t.jsx)(w.Spinner,{size:"sm"})})]})]})}var sa=e.i(796066),si=e.i(878191);let sn=e=>{let{className:s,isSyncing:a=!1}=e,{t:i}=(0,I.useTranslation)("base");return(0,t.jsxs)(j.motion.div,{initial:{opacity:0,scale:.99},animate:{opacity:1,scale:1},transition:{duration:.1},className:(0,k.cn)(s,"bg-surface-l1 border border-border-l1 rounded-full flex items-center py-4 px-6 gap-3 max-w-[560px] mx-auto w-fit",a?"cursor-default":"cursor-pointer"),children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(eB.GDriveIcon,{size:24})}),a?(0,t.jsx)("p",{className:" text-secondary font-semibold text-base",children:i("connectors.google-drive.syncing","Syncing files...")}):(0,t.jsxs)("div",{className:"flex justify-between w-full gap-2",children:[(0,t.jsx)("p",{className:" text-fg-primary font-semibold text-base",children:i("connectors.google-drive.sync-complete","Ask Grok about your files")}),(0,t.jsx)(si.ChevronRightIcon,{className:"ms-auto text-fg-secondary"})]})]},"gdrive-oauth-card")};e.s(["useSharedWithMeLinks",()=>sd],680126);var sr=e.i(924219),so=e.i(111669),sl=e.i(534626),sc=e.i(93910);function sd(e){let{pageSize:t=60,orderBy:s="createTime"}=e,a=(0,em.useSession)(),i=(0,sc.useShareRoute)(),n=a.user,{currentTeam:r,isSwitchingTeam:o}=(0,eL.useEnterprise)(),{ASSET_SERVER_URL:c}=(0,l.useEnvironment)(),{data:d,isLoading:u}=(0,eH.useQuery)({queryKey:["team-members",null==r?void 0:r.teamId],enabled:!!(null==r?void 0:r.teamId),queryFn:async()=>(null==r?void 0:r.teamId)?eq.authMgmtApi.authManagementListUsers({teamId:r.teamId}).then(e=>{var t;return(null==(t=e.members)?void 0:t.filter(e=>{var t;return(null==(t=e.user)?void 0:t.userId)!==(null==n?void 0:n.userId)}))||[]}).catch(e=>((0,y.logError)("share-dialog:fetch-team-members",e),[])):[]}),m=(0,S.useMemo)(()=>{let e=new Map;return null==d||d.forEach(t=>{var s,a,i,n,r,o;e.set((null==(s=t.user)?void 0:s.userId)||"",{userId:(null==(a=t.user)?void 0:a.userId)||"",xUserId:(null==(i=t.user)?void 0:i.xUserId)||"",givenName:(null==(n=t.user)?void 0:n.givenName)||"",familyName:(null==(r=t.user)?void 0:r.familyName)||"",profileImageUrl:(0,R.getAssetUrl)(c,null==(o=t.user)?void 0:o.profileImage)})}),e},[d,c]),p=(0,S.useRef)(null),g=(0,S.useRef)(null),[h,x]=(0,S.useState)(!1),[f,v]=(0,S.useState)(!1),b=(0,S.useCallback)(async e=>{let{pageParam:a}=e;if(!n)return{shareLinkResults:[],nextPageToken:void 0};let{shareLinks:i,nextPageToken:r}=await eq.chatApi.chatListShareLinks({sharedWithMe:!0,pageToken:"string"==typeof a?a:void 0,pageSize:t.toString(),orderBy:"createTime"===s?sr.ChatListShareLinksOrderByEnum.ListShareLinksOrderByCreateTime:"viewCount"===s?sr.ChatListShareLinksOrderByEnum.ListShareLinksOrderByViewCount:sr.ChatListShareLinksOrderByEnum.ListShareLinksOrderByInvalid});return{shareLinkResults:(null==i?void 0:i.map(e=>{var t;let{sharedLink:s,...a}=e;return{...a,conversation:(null==s?void 0:s.conversation)||null,response:(null==s||null==(t=s.responses)?void 0:t.find(t=>t.responseId===e.responseId))||null}}))||[],nextPageToken:r}},[n,t,s]),{data:j,fetchNextPage:I,hasNextPage:w,isFetchingNextPage:N,isFetching:C,isError:k,isLoading:M,refetch:T}=(0,so.useInfiniteQuery)({queryKey:["share-links",null==n?void 0:n.userId,t,s],queryFn:b,initialPageParam:void 0,getNextPageParam:e=>e.nextPageToken,enabled:!!n&&!!(null==r?void 0:r.teamId)&&!o,staleTime:6e5,refetchOnWindowFocus:!0}),E=(0,S.useMemo)(()=>{var e;let t=(null==j||null==(e=j.pages.flatMap(e=>e.shareLinkResults))?void 0:e.filter(e=>!!e.shareLinkId))||[],a="createTime"===s?t.sort((e,t)=>new Date((null==t?void 0:t.createTime)||Date.now()).getTime()-new Date((null==e?void 0:e.createTime)||Date.now()).getTime()):t.sort((e,t)=>parseInt(t.viewCount||"0")-parseInt(e.viewCount||"0"));return sl.uniqBy(e=>null==e?void 0:e.shareLinkId,a).map(e=>({...e,user:(null==e?void 0:e.xaiUserId)?m.get(e.xaiUserId):void 0}))},[null==j?void 0:j.pages,m,s]),P=(0,S.useCallback)(e=>{let t=E.find(t=>t.shareLinkId===e);return(null==t?void 0:t.publicId)?i(t.publicId):i(e)},[E,i]),D=(0,S.useCallback)(e=>{window.location.href=P(e)},[P]);return(0,S.useEffect)(()=>{if(!(null==p?void 0:p.current)||!(null==g?void 0:g.current))return;let e=new IntersectionObserver(e=>{let[t]=e;t&&x(t.isIntersecting)},{root:g.current,rootMargin:"300px 0px 300px 0px",threshold:.1}),t=p.current;if(t)return e.observe(t),()=>{e.unobserve(t)}},[null==p?void 0:p.current,null==g?void 0:g.current]),(0,S.useLayoutEffect)(()=>{h&&w&&!N&&n&&!f&&(v(!0),I().catch(e=>(0,y.logError)("intersection-load-more",e)))},[h,w,N,I,n,f]),(0,S.useEffect)(()=>{if(f){let e=setTimeout(()=>{v(!1)},300);return()=>clearTimeout(e)}},[f]),{results:E,refetch:T,loadMoreRef:p,containerRef:g,isLoading:M,isFetching:C,isError:k,isLoadingTeamMembers:u,getShareLinkHref:P,handleNavigateToSharedConversation:D}}let su=e=>{let{className:s}=e,{t:a}=(0,I.useTranslation)("base"),{isSwitchingTeam:i}=(0,eL.useEnterprise)(),{results:n,isFetching:r,isError:o,isLoadingTeamMembers:l,handleNavigateToSharedConversation:c}=sd({pageSize:60,orderBy:"viewCount"}),d=(0,S.useMemo)(()=>r||i,[r,i]);return(0,t.jsx)(tr,{transition:{duration:.2,ease:"easeInOut"},children:(0,t.jsxs)("div",{className:(0,k.cn)("@container/shared-with-me w-full",s),children:[(0,t.jsxs)("div",{className:"px-4 flex justify-between items-center gap-3",children:[(0,t.jsx)("span",{className:"text-xs text-fg-secondary",children:a("team-insights.shared-with-me","Shared with me")}),(0,t.jsx)(ev.Link,{route:{page:"history",tab:"shared-with-me"},className:"text-xs text-fg-tertiary hover:text-fg-secondary transition-all",children:a("team-insights.see-all","See all")})]}),o?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center items-center mx-4 py-6 mt-4 border border-border-l1 rounded-2xl",children:(0,t.jsx)("span",{className:"text-fg-tertiary text-sm",children:a("team-insights.error-loading-data","Could not load data")})},"error"):(0,t.jsx)("div",{className:"px-4 mt-4 grid grid-cols-3 w-full gap-4",children:(0,t.jsx)(b.AnimatePresence,{initial:!1,children:Array.from({length:3}).map((e,s)=>{let a=n[s];return(0,t.jsx)(sm,{shareLink:a,isLoading:d,isLoadingTeamMembers:l,onClick:a?()=>c(a.shareLinkId):void 0},"shared-with-me-".concat(s))})})})]})})},sm=e=>{var s,a,i;let{shareLink:n,isLoading:r,isLoadingTeamMembers:o,onClick:l}=e,c=(0,S.useMemo)(()=>!r&&!n,[r,n]);return(0,t.jsxs)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:l,className:(0,k.cn)("p-3 flex flex-col gap-2 bg-surface-l1 border border-border-l1 rounded-2xl transition-colors relative",{"cursor-pointer hover:bg-surface-l2":!!n&&!r,"bg-transparent":c}),children:[(0,t.jsx)("div",{className:"h-5 flex items-center min-w-0",children:(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:r?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(e3.Skeleton,{className:"h-2 w-20 rounded-sm"})},"loading"):n&&(0,t.jsx)(j.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-primary truncate",children:(null==(s=n.conversation)?void 0:s.title)||"Untitled Conversation"},"title")})}),(0,t.jsx)("div",{className:"h-4 flex items-center min-w-0 ",children:(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:r||o?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(e3.Skeleton,{className:"h-2 w-16 rounded-sm"})},"loading-user"):n&&(0,t.jsx)(j.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-fg-secondary text-xs truncate",children:"".concat((null==n||null==(a=n.user)?void 0:a.givenName)||""," ").concat((null==n||null==(i=n.user)?void 0:i.familyName)||"")},"user")})}),(0,t.jsx)(b.AnimatePresence,{initial:!1,children:c&&(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:(0,k.cn)("absolute inset-0 flex justify-center items-center"),children:(0,t.jsx)("div",{className:"w-10 border-b border-border-l1"})},"empty-state")})]})};var sp=e.i(603004),sg=e.i(286591);let sh="connectorOauthSuccess";var sx=e.i(451046);e.i(244179);var sf=e.i(860078),sv=e.i(390675);let sy={shouldOauthGoogleDrive:!1,syncGoogleDriveInProgress:!1,syncGoogleDriveSuccess:!1};function sb(){let{t:e}=(0,I.useTranslation)("chat"),{isSuperGrokUser:s,isEnterpriseUser:a,isSuperGrokProUser:i,bestSubscription:n,isPending:o}=(0,e_.useSubscriptions)(),{data:{enableVoiceMode:l}={}}=(0,tQ.useFeatureControls)(),c=(0,tL.useTasksStore)(B.prop("initialized")),d=(0,S.useRef)(null),u=(0,tA.useRoutingStore)(e=>e.route),m=(0,tA.useRoutingStore)(e=>e.mainPageScrollPosition),p=(0,tA.useRoutingStore)(e=>e.clearMainPageScrollPosition);(0,sa.useLoadHighlights)();let g=(0,S.useRef)(""),{signInWithReturnTo:x}=(0,eg.useGrokRouter)(),v=(0,A.useLogEvent)(),w=(0,P.useFeatureFlags)(),{handleVoiceModeEnter:N}=(0,tk.useVoiceMode)({location:"chat-new"}),C=(0,r.useChatPageStore)(e=>e.establishNewConversation),M=(0,U.useSettingsStore)(B.prop("isIncognito")),T=(0,r.useChatPageStore)(B.prop("activeModelId")),D=(0,r.useChatPageStore)(B.prop("defaultAnonModelId")),R=(0,r.useChatPageStore)(B.prop("defaultFreeModelId")),z=(0,r.useChatPageStore)(B.prop("defaultProModelId")),G=(0,r.useChatPageStore)(B.prop("setDefaultAnonModelId")),H=(0,r.useChatPageStore)(B.prop("setDefaultFreeModelId")),q=(0,r.useChatPageStore)(B.prop("setDefaultProModelId")),V=(0,r.useChatPageStore)(B.prop("reasoningMode")),Y=(0,r.useChatPageStore)(B.prop("setReasoningMode")),K=(0,r.useChatPageStore)(B.prop("conversationId")),Q=(0,r.useChatPageStore)(B.prop("conversationId"))||"no_conversation_id",X=(0,r.useChatPageStore)(e=>e.queryByConversationId[Q])||"",J=(0,W.useMobileSize)(),Z=(0,W.useMobileSize)(640),$=(0,f.useMobileUa)(),[ee]=(0,_.useLocalStorage)("visited-imagine2",!1),[et]=(0,_.useLocalStorage)("imagine-banner-impressions2",0),[es,ea]=(0,S.useState)(!1);(0,S.useEffect)(()=>{X&&ea(!0)},[X]);let ei=Z?e("Ask Grok","Ask Grok"):e("query-bar-placeholder.1","What do you want to know?"),{sessionStartTime:en,conversationDepth:er}=(0,t9.useTimeToValueAnalytics)(K),eo=(0,L.useFileStore)(B.prop("listByConversationId")),el=(0,L.useFileStore)(B.prop("attachListByConversationId")),ec=(0,O.useImageEditorStore)(B.prop("isOpen")),ed=(0,S.useMemo)(()=>eo.no_conversation_id||[],[eo]),eu=(0,S.useMemo)(()=>el.no_conversation_id||[],[el]),ep=(0,tT.useForceSignInModels)(),eh=(0,W.useMobileSize)(),ex=(0,eA.useIsActiveGrokBusinessSession)(),ef=(0,tR.useSuggestionStore)(e=>e.suggestions.length>0),ev=(0,tR.useSuggestionStore)(e=>e.clearList),ey=(0,tP.useIsFirstTimeUser)(),eC=(0,S.useMemo)(()=>ex&&!M&&(eh||!ef),[ex,ef,M,eh]),ek=!$&&!J&&!ex&&et<=10&&!ee&&0===X.length&&!es,eM=(0,S.useMemo)(()=>!M&&(ed.length>0&&!!ed.every(e=>e.file.type.includes("image"))||(null==eu?void 0:eu.length)>0&&!!eu.every(e=>e.mimeType.includes("image"))),[ed,eu,M]),eT=(0,S.useMemo)(()=>!M&&(ed.length>0&&!!ed.every(e=>e.metadata&&e.file.type.includes("csv"))||(null==eu?void 0:eu.length)>0&&!!eu.every(e=>e.mimeType.includes("csv"))),[ed,eu,M]),[eE,eP]=(0,S.useState)(!1),eR=(0,S.useCallback)(()=>{var e;let t=null!=(e=window.localStorage.getItem("hideTaskPillCount"))?e:0;window.localStorage.setItem("hideTaskPillCount",String(Number(t)+1)),eP(!1)},[]),ez=(0,E.useMaybeRefreshAnonSession)(),eU=(0,em.useSession)().user,eB=(0,S.useRef)(null),eG=(0,S.useCallback)(()=>{var e;null==(e=eB.current)||e.focus()},[eB]);(0,eN.useHotkeys)(ew.KBD_NEW_CHAT,eG,[]);let{handleKeyDown:eH,consumeCompositionTimeMs:eq,consumeBackspaceCount:eW,consumeAvgKeystrokeLatency:eV,consumeKeystrokeCount:eY,position:eK,setPosition:eQ,consumePosition:eX,consumeTypeaheadReqCount:eJ,incrementTypeaheadReqCount:eZ,incrementSuggestionsShownCount:e$,consumeSuggestionsShownCount:e0}=(0,tM.useAutocompleteMetrics)(),e1=(0,S.useCallback)(e=>{"Escape"===e.key&&ev(),eH(e)},[eH,ev]),e2=(0,S.useCallback)(e=>{let{query:t,fileAttachmentIds:s,webpageUrls:a,toolOverrides:i,isPreset:r,workspaceIds:o,persona:l,isIncognitoOverride:c,disableMemory:d,modelIdOverride:u,suggestion:m}=e;if(!t)return Promise.resolve(!1);if(!eU&&ep.includes(u||T))return v("sign_in","chat-new",{location:"chat-new"}),x(t,V),Promise.resolve(!1);let p=U.useSettingsStore.getState(),g=eX(),h=e0(),f=(0,t8.toAnalytics)({activeModelId:u||T,modelMode:u?"":void 0,query:t,fileAttachmentIds:s,webpageUrls:a,location:"chat-new",personalityId:p.userSettings.preferences.selectedSystemPromptId||"",personaId:"",sessionStartTime:en,conversationDepth:er,isMobile:J,bestSubscription:n,user:!!eU,compositionTime:eq(),backspaceCount:eW(),avgKeystrokeLatency:eV(),keystrokeCount:eY(),position:g,typeaheadRequestCount:eJ(),suggestionsShownCount:h,workspaceCount:(null==o?void 0:o.length)||0,toolOverrides:i,suggestionsSource:w.ENABLE_LLM_SUGGESTIONS?"grok":"bing",parentResponseId:"",isFirstTimeUser:ey,suggestion:m});return v("send_query","",f),ez().then(()=>((0,t_.reportSubmit)(),ev(),!!C({message:t,fileAttachmentIds:s,webpageUrls:a,toolOverrides:i,temporary:null!=c?c:M,isPreset:r,persona:l,enableRetries:!0,ff:w,workspaceIds:o,disableMemory:d,modelIdOverride:u}).catch((0,y.createLogError)("chat-new:establishNewConversation"))))},[eU,ep,T,eX,en,er,J,n,eq,eW,eV,eY,eJ,e0,w,ey,v,ez,x,V,ev,C,M]),{modelById:e3,defaultAnonModelId:e4,defaultFreeModelId:e6,defaultProModelId:e5,isPending:e8}=(0,tT.useModels)(),e9=(0,r.useChatPageStore)(e=>e.setActiveModelId),e7=(0,r.useChatPageStore)(e=>e.setModelMode),{shouldOauthGoogleDrive:te,syncGoogleDriveInProgress:tt}=(()=>{var e;let{t:s}=(0,I.useTranslation)("chat"),a=(0,sx.useIsXaiEmployee)(),{currentTeam:i}=(0,eL.useEnterprise)(),n=!!(null==i?void 0:i.teamId),{data:r=[],isPending:o}=(0,sv.useListConnectorsForUser)(),l=(0,eb.useRouter)(),c=(0,eb.useSearchParams)(),d=c.get(sh)||"",u=null!=(e=sf.ConnectorType[d])?e:sf.ConnectorType.CONNECTOR_TYPE_UNKNOWN,m=(0,S.useRef)(!1),p=(0,sp.useConnectorTypeToLabel)();if((0,S.useEffect)(()=>{if(0===r.length||!n||!a||!u||u===sf.ConnectorType.CONNECTOR_TYPE_UNKNOWN||m.current)return;m.current=!0,setTimeout(()=>F.toast.success((0,t.jsxs)("div",{className:"flex items-center gap-3 align-top pr-2",children:[(0,t.jsx)(sg.Clock,{className:"size-5 text-secondary"}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("div",{className:"text-primary font-bold text-sm",children:s("connector-oauth-success.title","Connected! Files are syncing...",{connectorType:p(u)})}),(0,t.jsx)("div",{className:"text-xs text-secondary",children:s("connector-oauth-success.description","We'll notify you when syncing is complete")})]})]}),{duration:1e4}),0);let e=new URL(window.location.href),i=new URLSearchParams(c.toString());i.delete(sh);let o="".concat(e.pathname).concat(i.size>0?"?".concat(i.toString()):"").concat(e.hash);l.replace(o,{scroll:!1})},[r,n,a,c,u,l,s,p]),!n||!a||o)return{...sy};let g=r.find(e=>e.connectorType===sf.ConnectorType.CONNECTOR_TYPE_GOOGLE_DRIVE);return{shouldOauthGoogleDrive:!!g&&!g.isActiveForUser,syncGoogleDriveInProgress:!!g&&!!g.isActiveForUser&&!g.latestSuccessfulSync,syncGoogleDriveSuccess:!1}})();(0,S.useEffect)(()=>{if(e8||o&&eU)return;let e=new URLSearchParams(location.search),t=e.get("q"),n=e.get("reasoningMode"),r=e.get("fileid"),l=tD[Number(e.get("m"))],c=location.hash===tz.INCOGNITO_HASH;if(l&&e3[l])U.useSettingsStore.getState().fetchSetPreference("useModelModeSelector3",!1).catch((0,y.createLogError)("chat-new:mount:fetchSetPreference:useModelModeSelector3")),e9(l);else if(z!==e5&&(a||s||i)&&e5&&e3[e5])q(e5),e9(e5);else if(R!==e6&&eU&&e6&&e3[e6])H(e6),e9(e6);else if(D!==e4&&e4&&e3[e4])G(e4),e9(e4);else if(n){let e=tE.reasoningModeSchema.parse(n);e&&Y(e)}t&&!g.current&&(e2({query:t,fileAttachmentIds:r?[r]:void 0,webpageUrls:[],isIncognitoOverride:c,disableMemory:!0,modelIdOverride:l}).catch(e=>{(0,y.logError)("chat-new:mount:handleSend",e)}),g.current="auto-start")},[e8,o]);let ts=(0,S.useCallback)(e=>{let{query:t,suggestion:s}=e;e2({query:t,suggestion:s}).catch(e=>{(0,y.logError)("chat-new:handleClickSuggestionItem",e)})},[e2]),ta=(0,S.useCallback)(t=>{let{query:s,parentQuotedText:a,fileAttachmentIds:i,webpageUrls:n,toolOverrides:r,isPreset:o,persona:l}=t;if(l){let t=(0,tN.mapPersonaToSettings)(l.personaId,e);t.modelMode&&e7(t.modelMode)}e2({query:s,parentQuotedText:a,fileAttachmentIds:i,webpageUrls:n,toolOverrides:r,persona:l,isPreset:o}).catch(e=>{(0,y.logError)("chat-new:handleClickSuggestion",e)})},[e2,e7,e]),ti=(0,S.useCallback)(()=>{let t=[...ed.map(e=>e.metadata).filter(e=>e&&!(e instanceof Error)).map(e=>e.fileMetadataId),...eu.map(e=>e.assetId)];e2({query:e("create-report-prompt","Create a report"),fileAttachmentIds:t}).catch(e=>{(0,y.logError)("chat-new:handleClickCreateReport",e)})},[e2,ed,eu,e]);(0,S.useEffect)(()=>{(0,t_.reportPageReady)()},[]),(0,S.useEffect)(()=>{"main"===u.page&&null!==m&&d.current&&setTimeout(()=>{d.current&&(d.current.scrollTop=m),p()},0)},[u.page,m,p]);let tn=(()=>{if(!ef){if(eM&&!M)return(0,t.jsx)("div",{className:"bg-background rounded-full",children:(0,t.jsxs)(ej.ImageEditorTrigger,{shouldGetFromStore:!0,buttonProps:{variant:"filledSecondary",size:"md",rounded:!0},location:"chat-new-input",children:[(0,t.jsx)(tI.ScanImageIcon,{className:"size-5 text-secondary"}),e("Edit Image","Edit Image")]})},"edit");if(eT&&!M)return(0,t.jsx)(j.motion.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"bg-background rounded-full",children:(0,t.jsxs)(h.Button,{size:"md",variant:"secondary",shape:"pill",onClick:ti,children:[(0,t.jsx)(tw.ScanSearchIcon,{}),(0,t.jsx)("p",{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:e("create-report","Create Report")})]})},"edit");if(ek)return(0,t.jsx)(j.motion.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",transition:{duration:.1},exit:"hidden",className:(0,k.cn)("w-full flex justify-center",{invisible:M}),children:(0,t.jsx)(eD,{})},"imagine-banner");if(c&&!eh&&eE)return(0,t.jsx)(j.motion.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:(0,k.cn)("w-full flex justify-center",{invisible:M}),children:(0,t.jsx)(t4,{onHide:eR})},"task-pill");if(!eh&&!eM&&!eT&&eC)return(0,t.jsxs)(j.motion.div,{variants:{hidden:{opacity:0},visible:{opacity:1}},initial:"hidden",animate:"visible",transition:{duration:.2},className:(0,k.cn)("w-full",tC.QUERY_BAR_MAX_WIDTH_CLASS),children:[(0,t.jsx)(to,{className:"w-full mt-7"}),(0,t.jsx)(b.AnimatePresence,{mode:"wait",children:te?(0,t.jsx)(eF,{className:"mt-12 mb-6"}):tt?(0,t.jsx)(sn,{isSyncing:!0,className:"mt-12 mb-6"}):w.ENABLE_TEMPLATES?(0,t.jsx)(tj,{className:"w-full mt-10 mb-6"}):(0,t.jsx)(su,{className:"w-full mt-10 mb-6"})})]},"teams-ui");if(!eh&&!M&&!ex)return(0,t.jsxs)("div",{className:"flex flex-col items-center gap-6 w-full",children:[(0,t.jsx)(tX,{handleSend:ta}),(0,t.jsx)(ss,{scrollContainerRef:d})]})}})();return(0,t.jsx)("div",{ref:d,className:"flex flex-col items-center w-full h-full p-2 mx-auto justify-center @sm:p-4 @sm:gap-9 isolate mt-16 @sm:mt-0 overflow-scroll",children:(0,t.jsxs)("div",{className:(0,k.cn)("flex flex-col items-center gap-6 h-[450px] w-full @sm:pt-12 isolate transition-transform",{"@sm:-translate-y-20":ex&&!eh}),children:[(0,t.jsxs)("div",{className:(0,k.cn)("flex flex-col items-center justify-center w-full @sm:px-4 px-2 gap-6 @sm:gap-4 @xl:w-4/5 flex-initial pb-0",tC.QUERY_BAR_MAX_WIDTH_CLASS),children:[(0,t.jsx)(eO,{height:64,width:320}),eh&&(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:eC?(0,t.jsxs)(j.motion.div,{variants:{hidden:{opacity:0},visible:{opacity:1}},initial:"hidden",animate:"visible",transition:{duration:.2},className:(0,k.cn)("w-full",tC.QUERY_BAR_MAX_WIDTH_CLASS),children:[(0,t.jsx)(to,{className:"w-full my-6"}),te&&(0,t.jsx)(eF,{className:"my-6"})]},"teams-ui"):ef?null:(0,t.jsx)(tX,{handleSend:ta})})]}),(0,t.jsxs)("div",{className:(0,k.cn)("absolute bottom-0 mx-auto inset-x-0",tC.QUERY_BAR_MAX_WIDTH_CLASS,"@sm:relative flex flex-col items-center w-full gap-1 @sm:gap-5 @sm:bottom-auto @sm:inset-x-auto @sm:max-w-full"),children:[(0,t.jsxs)("div",{className:(0,k.cn)("flex flex-col-reverse items-center justify-between flex-1 w-full gap-0 @sm:gap-3 @sm:flex-col relative","p-2 @sm:p-0"),children:[(0,t.jsx)("div",{className:(0,k.cn)("w-full",!ef||Z?"mb-3":""),children:(0,t.jsx)(eS.QueryBar,{className:"mt-2",textAreaClassName:"min-h-14 py-4 my-0 mb-0",placeholder:ei,onQuery:e2,onFrontPage:!ec,ref:eB,isIncognito:M,enableVoiceMode:l,onKeyDown:e1,onVoiceModeEnter:N,showingSuggestions:ef&&!Z&&!M,onBlur:ev},"query-bar")}),(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:tn}),(0,t.jsx)(tU.ChatAutoCompleteSuggestions,{className:(0,k.cn)("overflow-visible",M&&"invisible",eh?"!mb-1":"-mt-2"),handleSend:ts,position:eK,setPosition:eQ,placement:eh?"top":"bottom",incrementTypeaheadReqCount:eZ,incrementSuggestionsShownCount:e$}),(0,t.jsx)(eI.UpsellSuperGrokSmall,{})]}),eU?null:(0,t.jsx)("div",{className:"text-[11px] @sm:text-xs text-secondary text-nowrap",children:(0,t.jsx)(tO.Trans,{ns:"chat",i18nKey:"clickwrapAgreement",defaults:"By messaging Grok, you agree to our <terms>Terms</terms> and <policy>Privacy Policy</policy>.",components:{terms:(0,t.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/terms-of-service",target:"_blank",rel:"noopener noreferrer"}),policy:(0,t.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/privacy-policy",target:"_blank",rel:"noopener noreferrer"})}})})]})]})})}var sj=e.i(211350),sS=e.i(141769);function sI(e){let{conversationIsLoading:s,conversationError:a,optimisticConversationId:i,conversationId:n,conversation:o,templateId:l}=e,c=(0,ei.useRequestErrorToastFn)(),d=(0,r.useChatPageStore)(B.prop("conversationMode")),{data:{enableVoiceMode:u}={}}=(0,tQ.useFeatureControls)();return((0,S.useEffect)(()=>{(null==o?void 0:o.conversationId)&&z.useResponseStore.getState().loadInitialResponses(o.conversationId).then(e=>{var t;let s=r.useChatPageStore.getState();if(s.conversationId===(null==(t=e[0])?void 0:t.conversationId)){let t=(0,sj.getMostRecentResponse)(e);if(!t)return void s.setLastMessageId(void 0);if("streaming"===t.state||"reconnecting"===t.state){s.setLastMessageId(t.parentResponseId),s.setStreamedMessageId(t.responseId);return}if("optimistic"===t.state){s.setLastMessageId(t.parentResponseId),s.setOptimisticMessageId(t.responseId);return}s.setLastMessageId(t.responseId)}}).catch(e=>{c("chat-page:loadInitialResponses",e)})},[null==o?void 0:o.conversationId]),i)?(0,t.jsx)(sS.ChatInteraction,{conversationId:i,conversation:void 0,isOptimisticConversation:!0,conversationIsLoading:s,conversationError:a,enableVoiceMode:u,templateId:l},"voice"===d?"voice-chat-interaction":"chat-interaction"):n?(0,t.jsx)(sS.ChatInteraction,{conversationId:n,conversation:o||void 0,isOptimisticConversation:!1,conversationIsLoading:s,conversationError:a,enableVoiceMode:u},"chat-interaction"):null}e.s(["DropPrompt",()=>sk],689280);var sw=e.i(755666);e.i(200942);var sN=e.i(274920),sC=e.i(804220);function sk(e){let{conversationId:s,containerRef:a,user:i,imageAttachmentsOnly:n=!1}=e,{t:o}=(0,I.useTranslation)("chat"),l=function(e,t,s){let{t:a}=(0,I.useTranslation)("base"),i=(0,r.useChatPageStore)(B.prop("activeModelId")),{modelById:n}=(0,tT.useModels)(),o=null==n?void 0:n[i],{isAttachDisabled:l}=(0,tT.useModelFeatures)(o),{data:{enableImageUploads:c}={}}=(0,tQ.useFeatureControls)(),{attachFiles:d}=(0,sw.useFileAttachments)(),u=(0,A.useLogEvent)(),{user:m}=(0,em.useSession)(),p=(0,L.useFileStore)(B.prop("listByConversationId"))[e||"no_conversation_id"]||[];return"hover"===(0,sN.useDropZone)({onDrop:e=>{m&&(d(e),e.forEach(e=>{u("upload_file",e.name,{location:"file-drop",mimeType:e.type})}))},canDrop:e=>{var t;return!c&&e.files.some(e=>null==e?void 0:e.type.startsWith("image/"))?(F.toast.error(a("feature-controls.enable-image-uploads.forbidden","Image uploads are disabled for your team.")),!1):!l&&!!e.files.length&&(!s||!(e.files.length>1)&&!!(null==(t=e.files[0])?void 0:t.type.startsWith("image/")))&&(!p.length||!p.find(t=>{var s;return t.file.name===(null==(s=e.files[0])?void 0:s.name)}))},ref:t},[p,m,l,d])}(s,a,n),c=(0,r.useChatPageStore)(B.prop("activeModelId")),{modelById:d}=(0,tT.useModels)(),u=null==d?void 0:d[c],{isAttachDisabled:m,isThinkSelected:p,isDeepsearchSelected:g}=(0,tT.useModelFeatures)(u);return(0,t.jsx)(b.AnimatePresence,{children:l&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-overlay z-50"},"drop-backdrop"),(0,t.jsx)(j.motion.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:20},className:"absolute inset-0 z-50 flex items-center justify-center p-6 pointer-events-none",children:i?m?(0,t.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,t.jsx)("div",{children:(0,t.jsx)(sC.TriangleAlert,{size:32,className:"text-red-400"})}),(0,t.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:o("Attachments are disabled","Attachments are disabled")}),(0,t.jsxs)("p",{className:"text-secondary",children:[o("Attachments are disabled for","Attachments are disabled for")," ",(0,t.jsx)("span",{className:"font-semibold",children:p?"Think":g?"DeepSearch":void 0})]})]}):(0,t.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,t.jsx)("div",{children:(0,t.jsx)(es.ImagePlusIcon,{size:32,className:"text-secondary"})}),(0,t.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:o("Drop your files here","Drop your files here")}),(0,t.jsx)("p",{className:"text-secondary",children:o("Drop your files here to add them to your conversation","Drop your files here to add them to your conversation")})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center w-full max-w-xl py-12 border-4 border-red-400 border-dashed rounded-2xl bg-background",children:[(0,t.jsx)("div",{children:(0,t.jsx)(es.ImagePlusIcon,{size:32,className:"text-secondary"})}),(0,t.jsx)("h2",{className:"mt-4 mb-2 text-lg font-medium text-red-400",children:o("Sign in to attach files!","Sign in to attach files!")}),(0,t.jsx)("p",{className:"text-secondary",children:o("You must be signed in to attach files to your conversation","You must be signed in to attach files to your conversation")})]})},"drop-modal")]})})}let sM=(0,p.default)("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);var sT=e.i(272809);let sE=e=>{let{onDismiss:s}=e,{t:a}=(0,I.useTranslation)("base"),[i,n]=(0,S.useState)("ASK"),r=(0,U.useSettingsStore)(B.prop("fetchSetPreference")),o=async()=>{if("granted"===Notification.permission||(n("WAIT"),"granted"===await Notification.requestPermission())){n("ALLOWED"),await r("browserNotificationsEnabled",!0);return}n("DENIED")};return((0,S.useEffect)(()=>{if("ASK"===i||"WAIT"===i)return;let e=setTimeout(s,2e3);return()=>clearTimeout(e)},[s,i]),(0,f.isMobileUa)())?null:"DENIED"===i?(0,t.jsxs)("div",{className:"flex items-center gap-4 min-w-[360px]",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:a("notifications_declined_title","Notifications declined")}),(0,t.jsx)("div",{className:"text-xs text-secondary",children:a("notifications_change_anytime","You can change this anytime in settings.")})]}),(0,t.jsx)(t3.X,{className:"size-5"})]}):"ALLOWED"===i?(0,t.jsxs)("div",{className:"flex items-center gap-4 min-w-[348px]",children:[(0,t.jsx)(sT.Check,{className:"size-5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:a("notifications_enabled_title","Notifications enabled")}),(0,t.jsx)("div",{className:"text-xs text-secondary",children:a("notifications_enabled_subtitle","We'll keep you updated")})]})]}):(0,t.jsxs)("div",{className:"flex justify-between items-center gap-4 relative group min-w-[360px]",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(sM,{className:"size-5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:a("notifications_ask_title","Get notified when Grok finishes answering")}),(0,t.jsx)("div",{className:"text-xs text-secondary",children:a("notifications_ask_subtitle","Enable notifications")})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 -me-2",children:[(0,t.jsx)(Q.Button,{className:"rounded-xl px-2 py-2",variant:"secondary",disabled:"WAIT"===i,onClick:o,children:a("notifications_enable","Enable")}),(0,t.jsx)(Q.Button,{variant:"textSecondary",size:"iconXs","aria-label":a("notifications-toast-dismiss","Dismiss"),onClick:()=>s(!0),children:(0,t.jsx)(t3.X,{className:"!size-4"})})]})]})};var sP=e.i(164877);function sD(e){let{conversationId:s,lastMessageId:a}=e,{t:i}=(0,I.useTranslation)("chat"),n=(0,r.useChatPageStore)(B.prop("requestShareDialogOpen")),o=(0,r.useChatPageStore)(B.prop("setRequestShareDialogOpen")),l=(0,W.useMobileSize)(),d=(0,A.useLogEvent)(),u=(0,S.useCallback)(e=>{o(e)},[o]);(0,S.useEffect)(()=>{n&&d("request_share_dialog_opened",void 0,{location:"request-share-dialog"})},[d,n]);let m=(0,S.useCallback)(()=>{o(!1)},[o]),p=(0,S.useCallback)(()=>{d("request_share_dialog_share_pressed",void 0,{location:"request-share-dialog"}),F.toast.success(i("share-request-dialog.share-success","Conversation shared!")),o(!1)},[o,d,i]),g=(0,S.useCallback)(()=>(0,t.jsxs)("div",{className:"space-y-4 py-2",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("div",{className:"h-1.5 w-1.5 rounded-full mt-2 flex-shrink-0 bg-primary"}),(0,t.jsx)("p",{className:"text-sm",children:i("share-request-dialog.viewers-can-only-see-current-messages","Viewers will be only able to see current messages at time of sharing.")})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("div",{className:"h-1.5 w-1.5 rounded-full mt-2 flex-shrink-0 bg-primary"}),(0,t.jsx)("p",{className:"text-sm",children:i("share-request-dialog.viewers-cannot-add-or-modify","Viewers will not be able to add or modify this conversation.")})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2 p-3 border rounded-md",children:[(0,t.jsx)(sP.AlertTriangle,{className:"h-4 w-4 text-secondary mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"text-sm text-secondary font-semibold",children:[i("share-request-dialog.note","Note"),":"]}),(0,t.jsx)("p",{className:"text-sm italic text-secondary",children:i("share-request-dialog.sharing-this-conversation-means-anybody-with-the-share-link-will-be-able-to-view-it","Sharing this conversation means anybody with the share link will be able to view it.")})]})]}),(0,t.jsxs)("div",{className:"w-full flex items-center gap-2 justify-end",children:[(0,t.jsx)(h.Button,{variant:"secondary",size:"md",shape:"rectangle",onClick:m,children:i("share-request-dialog.cancel","Cancel")}),s&&a&&(0,t.jsx)(c.ShareButton,{variant:"primary",size:"md",shape:"rectangle",conversationId:s,responseId:a,iconProps:{size:18,strokeWidth:2},showLabel:!0,onClick:p})]})]}),[s,m,p,a,i]);return l?(0,t.jsx)(X.Drawer,{open:n,onOpenChange:u,children:(0,t.jsxs)(X.DrawerContent,{className:"focus:outline-none bg-surface-l1 pt-1 p-6 h-[80dvh] mb-2",children:[(0,t.jsx)("div",{className:"text-lg font-semibold",children:i("share-request-dialog.title","Share request")}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground mb-4",children:i("share-request-dialog.description","Someone would like access to a shared version of this conversation.")}),g()]})}):(0,t.jsx)(el.Dialog,{open:n,onOpenChange:u,children:(0,t.jsxs)(el.DialogContent,{className:"sm:max-w-md rounded-3xl border border-border-l1 p-6",children:[(0,t.jsxs)(el.DialogHeader,{children:[(0,t.jsx)(el.DialogTitle,{className:"text-lg font-semibold",children:i("share-request-dialog.title","Share request")}),(0,t.jsx)(el.DialogDescription,{className:"text-sm text-muted-foreground",children:i("share-request-dialog.description","Someone would like access to a shared version of this conversation.")})]}),g()]})})}function s_(){let{user:e}=(0,em.useSession)(),n=(0,r.useChatPageStore)(B.prop("optimisticConversationId")),o=(0,r.useChatPageStore)(B.prop("conversationId")),l=(0,r.useChatPageStore)(B.prop("lastMessageId")),c=(0,r.useChatPageStore)(B.prop("conversationMode")),d=(0,ey.useConversationStore)(B.prop("fetchGetConversation")),u=(0,eb.useSearchParams)(),m=(0,eb.useRouter)(),p=(0,eb.usePathname)(),{route:g}=(0,ev.useRouting)();(0,S.useEffect)(()=>{var e;if("chat"===g.page&&g.temporary)return;let t="chat"===g.page&&null!=(e=g.conversationId)?e:void 0;r.useChatPageStore.setState({conversationId:t})},[g]);let h=(0,r.useChatPageStore)(B.prop("setRequestShareDialogOpen"));(0,S.useEffect)(()=>{let e="SHARE_REQUESTED";if("true"===u.get(e)){h(!0);let t=new URLSearchParams(u.toString());t.delete(e),m.replace("".concat(p,"?").concat(t.toString()),{scroll:!1})}},[p,m,u,h]),(()=>{let{t:e}=(0,I.useTranslation)("base"),[s,a]=(0,S.useState)(""),i=(0,r.useChatPageStore)(e=>e.lastMessageId),n=(0,r.useChatPageStore)(e=>e.streamedMessageId),o=(0,z.useResponseStore)(e=>e.byId),l=o[i||""],c=o[n||""],d=(0,S.useMemo)(()=>{let e=l;for(;e&&"human"!==e.sender;)e=e.parentResponseId?o[e.parentResponseId]:void 0;return null==e?void 0:e.message},[l,o]),[u,m]=(0,_.useLocalStorage)("notifications-toast-dismiss-count",0),[p,g]=(0,S.useState)(0),h=(0,S.useRef)(new Set),x=(0,U.useSettingsStore)(e=>e.userSettings.preferences.browserNotificationsEnabled),f=(0,S.useCallback)(()=>{var t,s;if(null==(t=document)?void 0:t.hasFocus())return;let a=null==l||null==(s=l.uiLayout)?void 0:s.reasoningUiLayout;if("HEAVY"!==a&&"UNIFIED"!==a)return;let i="HEAVY"===a?e("notifications-heavy-answer-ready","Grok Heavy answer is ready"):e("notifications-answer-ready","Grok answer is ready"),n=window.matchMedia("(prefers-color-scheme: dark)").matches?"/images/notification-icon-dark.png":"/images/notification-icon-light.png";new Notification(i,d?{body:e("notifications-check-results-with-message",'Check results for "{{userMessage}}"',{userMessage:d}),icon:n}:{icon:n}).onclick=()=>{window.focus()}},[l,d,e]),v=(0,S.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];F.toast.dismiss(s),a(""),e&&m(e=>e+1)},[m,s]),y=!!(null==c?void 0:c.liveThinkingStartTime)||!!(null==c?void 0:c.thinkingStartTime)||!!(null==c?void 0:c.searchingStartTime)||(null==c?void 0:c.steps)&&c.steps.length>0;return(0,S.useEffect)(()=>{if(!x&&c&&y){if((null==c?void 0:c.state)==="streaming")return void g(1e3);(null==l?void 0:l.state)==="closed"&&g(0)}},[c,l,x,y]),(0,S.useEffect)(()=>{if(0===p||x)return;let e=setTimeout(()=>g(e=>e+1e3),1e3);return()=>clearTimeout(e)},[x,p]),(0,S.useEffect)(()=>{let e=p>=3e3&&p<=4e3;!s&&!x&&e&&u<1&&1&&a((0,F.toast)((0,t.jsx)(sE,{onDismiss:v}),{duration:1/0,className:"inset-x-0 mx-auto"}))},[u,v,p,s]),(0,S.useEffect)(()=>{(null==l?void 0:l.liveThinkingStartTime)&&(null==l?void 0:l.state)==="closed"&&(x&&i&&!h.current.has(i)&&(f(),h.current.add(i)),s&&(l.partial?v(!1):setTimeout(()=>v(!1),2e3)))},[x,v,l,f,s,i])})(),function(){let e=(0,eb.useSearchParams)(),{t}=(0,I.useTranslation)("chat"),s=(0,eb.useRouter)(),a=(0,S.useRef)(!1),i=e.get(ep.CONNECT_OAUTH_PROVIDER_SEARCH_PARAM),n=(0,ef.usePrettyOauthProvider)(i||"");(0,S.useEffect)(()=>{if(!a.current&&i){setTimeout(()=>F.toast.success(t("oauth.connection.success","Successfully connected {{provider}}!",{provider:n})),0),a.current=!0;let e=new URL(window.location.href);e.searchParams.delete(ep.CONNECT_OAUTH_PROVIDER_SEARCH_PARAM),s.replace("".concat(e.pathname).concat(e.search).concat(e.hash,"/"),{scroll:!1})}},[n,i,s,t])}(),function(e){let t=(0,ey.useConversationStore)(t=>e?t.byId[e]:void 0);(0,eh.useDocumentTitle)(null==t?void 0:t.title)}(o),function(){let e=(0,r.useChatPageStore)(B.prop("conversationMode")),t=(0,r.useChatPageStore)(B.prop("voiceConnectionStatus")),s=(0,r.useChatPageStore)(B.prop("exitVoiceMode")),a=(0,O.useImageEditorStore)(B.prop("isOpen")),{user:i}=(0,em.useSession)(),n=(0,P.useFeatureFlags)(),o=(0,ei.useRequestErrorToastFn)(),{route:l,replace:c}=(0,ev.useRouting)(),{signInWithReturnTo:d}=(0,eg.useGrokRouter)(),{handleVoiceModeEnter:u}=(0,tk.useVoiceMode)({location:"voice-chat-page"});(0,S.useEffect)(()=>{if("voice"in l&&l.voice&&"voice"!==e&&(c({page:"main",voice:!1}),n.ENABLE_VOICE_MODE))if(i)u().catch(e=>(0,y.logError)("chat-page:handleVoiceModeEnter",e));else{(0,y.logEventGlobal)("sign_in","voice-chat-page",{location:"voice-chat-page"}),d(void 0,void 0,!0);return}},[l,c,e,u,t,i,d,n]),(0,S.useEffect)(()=>{a&&"voice"===e&&s("navigation").catch(e=>{o("chat-page:exitVoiceMode",e)})},[a,e,s,o])}(),function(){let e=(0,eA.useIsActiveGrokBusinessSession)(),t=(0,P.useFeatureFlags)(),{route:s}=(0,ev.useRouting)(),a="optimistic_template_conversation";(0,S.useEffect)(()=>{let i=r.useChatPageStore.getState();if(e&&"main"===s.page&&s.templateId&&t.ENABLE_TEMPLATES&&!i.optimisticConversationId){i.setOptimisticConversationId(void 0),i.setOptimisticMessageId(void 0),i.setConversationId(void 0),i.setSidePanelContent(void 0);let e={...(0,ey.createOptimisticConversation)({conversationId:a,temporary:!0})},t=ey.useConversationStore.getState();t.upsertAndCacheConversation(e),i.setOptimisticConversationId(e.conversationId);let s=new AbortController;t.idsertAbortControllerById(s,e.conversationId)}if("main"===s.page&&!s.templateId&&i.optimisticConversationId&&i.optimisticConversationId===a){let e=ey.useConversationStore.getState();e.removeConversation(a),e.removeAbortControllerById(i.optimisticConversationId),i.setOptimisticConversationId(void 0)}},[e,t.ENABLE_TEMPLATES,s])}();let{data:x,isLoading:f,error:v}=(0,ex.usePromise)(o?d(o):void 0),{data:{enableFileUploads:b}={}}=(0,tQ.useFeatureControls)();(0,S.useEffect)(()=>{r.useChatPageStore.getState().setChatPageLoaded(!0)},[]);let j=(0,r.useChatPageStore)(B.prop("setQuotePopupData"));(0,S.useEffect)(()=>{let e=e=>{let t=window.getSelection();t&&0!==t.rangeCount&&0!==t.toString().trim().length||j(void 0)},t=e=>{let t=window.getSelection();t&&0!==t.rangeCount&&0!==t.toString().trim().length||j(void 0)};return document.addEventListener("click",e),document.addEventListener("selectionchange",t),()=>{document.removeEventListener("click",e),document.removeEventListener("selectionchange",t)}},[j]);let w=(0,S.useRef)(null),N=(0,S.useMemo)(()=>"main"===g.page&&g.templateId||void 0,[g]);return(0,t.jsx)(i.ErrorBoundary,{fallbackRender:()=>(0,t.jsx)(sA,{}),children:(0,t.jsxs)("main",{ref:w,className:(0,k.cn)("h-dvh flex-grow flex-shrink relative selection:bg-highlight w-0","@container isolate","print:h-full print:prose print:max-w-none"),children:[o&&l&&(0,t.jsx)(sD,{conversationId:o,lastMessageId:l}),(0,t.jsx)(a.TriggeredError,{hidden:!0}),b&&"chat"===c&&(0,t.jsx)(sk,{conversationId:o,containerRef:w,user:e}),(0,t.jsx)(tz.ChatTopNav,{conversationIsLoading:f,conversation:x||void 0,isOptimisticConversation:!!n}),(0,t.jsx)(s.CommandMenu,{}),n&&"main"===g.page||o&&"chat"===g.page?(0,t.jsx)(sI,{optimisticConversationId:n,conversationIsLoading:f,conversationError:v,conversationId:o,conversation:x,templateId:N},"conversation-view"):(0,t.jsx)(sb,{}),(0,t.jsx)(eu,{})]},"chat-page")})}function sA(){let{t:e}=(0,I.useTranslation)("chat");return(0,t.jsx)("div",{className:"w-full h-dvh flex justify-center items-center align-middle",children:(0,t.jsxs)("div",{className:"w-full max-w-lg text-center",children:[(0,t.jsx)(ev.Link,{route:{page:"main"},className:"mb-6 flex justify-center",children:(0,t.jsx)(n.GrokWordLogo,{height:20,width:60,className:"opacity-80 hover:opacity-100 fill-black dark:fill-white"})}),(0,t.jsx)("div",{children:e("There was an error","There was an error")}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)(Q.Button,{variant:"primary",size:"md",onClick:()=>{window.location.href="/"},children:e("Return to Home","Return to Home")})})]})})}}]);
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="d743efbe-71f2-510d-8320-49e657295beb")}catch(e){}}();
//# debugId=d743efbe-71f2-510d-8320-49e657295beb
