(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,676452,e=>{"use strict";e.s(["useHighlightsStore",()=>n]);var t=e.i(868275),s=e.i(332573),i=e.i(564448),r=e.i(477249),l=e.i(364778),o=e.i(486492);class a{constructor(e,s,r){var a=this;(0,t._)(this,"set",void 0),(0,t._)(this,"get",void 0),(0,t._)(this,"store",void 0),(0,t._)(this,"stories",void 0),(0,t._)(this,"isLoading",void 0),(0,t._)(this,"error",void 0),(0,t._)(this,"nextCursor",void 0),(0,t._)(this,"storyReactions",void 0),(0,t._)(this,"hasAnimated",void 0),(0,t._)(this,"setStories",void 0),(0,t._)(this,"setIsLoading",void 0),(0,t._)(this,"setError",void 0),(0,t._)(this,"setNextCursor",void 0),(0,t._)(this,"setHasAnimated",void 0),(0,t._)(this,"setStoryReaction",void 0),(0,t._)(this,"likeStory",void 0),(0,t._)(this,"dislikeStory",void 0),(0,t._)(this,"fetchStories",void 0),(0,t._)(this,"fetchMoreStories",void 0),(0,t._)(this,"getStory",void 0),(0,t._)(this,"getDiscussionPosts",void 0),(0,t._)(this,"reset",void 0),this.set=e,this.get=s,this.store=r,this.stories=[],this.isLoading=!1,this.error=null,this.nextCursor=void 0,this.storyReactions={},this.hasAnimated=!1,this.setStories=(0,i.assign)(this.set,"stories"),this.setIsLoading=(0,i.assign)(this.set,"isLoading"),this.setError=(0,i.assign)(this.set,"error"),this.setNextCursor=(0,i.assign)(this.set,"nextCursor"),this.setHasAnimated=(0,i.assign)(this.set,"hasAnimated"),this.setStoryReaction=(e,t)=>{this.set(s=>({storyReactions:{...s.storyReactions,[e]:t}}))},this.likeStory=e=>{let t=this.get().storyReactions[e];this.setStoryReaction(e,"liked"===t?null:"liked")},this.dislikeStory=e=>{let t=this.get().storyReactions[e];this.setStoryReaction(e,"disliked"===t?null:"disliked")},this.fetchStories=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;a.setIsLoading(!0),a.setError(null);try{let t=await l.highlightsApi.highlightsGetStories({limit:e}),s=a.get(),i=t.stories||[],r=new Set(s.stories.map(e=>e.storyId)),o=i.filter(e=>!r.has(e.storyId));a.set({stories:[...o,...s.stories],nextCursor:t.nextCursor,isLoading:!1})}catch(t){let e=t instanceof Error?t:Error("Failed to fetch highlights");a.set({error:e,isLoading:!1}),(0,o.logError)("highlights-store:fetchStories",t)}},this.fetchMoreStories=async()=>{let e=this.get();if(!e.isLoading&&e.nextCursor){this.setIsLoading(!0),this.setError(null);try{let t=await l.highlightsApi.highlightsGetStories({limit:10,cursor:e.nextCursor}),s=t.stories||[],i=new Set(e.stories.map(e=>e.storyId)),r=s.filter(e=>!i.has(e.storyId));this.set({stories:[...e.stories,...r],nextCursor:t.nextCursor,isLoading:!1})}catch(t){let e=t instanceof Error?t:Error("Failed to load more highlights");this.set({error:e,isLoading:!1}),(0,o.logError)("highlights-store:loadMore",t)}}},this.getStory=async e=>{let t=this.get().stories.find(t=>t.storyId===e);if(t)return Promise.resolve(t);try{let t=(await l.highlightsApi.highlightsGetStory({storyId:e})).story;if(!t)throw Error("Story not found");return this.set(e=>({stories:e.stories.some(e=>e.storyId===t.storyId)?e.stories:[...e.stories,t]})),t}catch(e){throw(0,o.logError)("highlights-store:getStory",e),e}},this.getDiscussionPosts=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,s=arguments.length>2?arguments[2]:void 0;try{let i=await l.highlightsApi.highlightsGetDiscussionPosts({storyId:e,limit:t,cursor:s});return{discussionPosts:i.discussionPosts||[],nextCursor:i.nextCursor||void 0}}catch(e){throw(0,o.logError)("highlights-store:getDiscussionPosts",e),e}},this.reset=()=>{this.set({stories:[],isLoading:!1,error:null,nextCursor:void 0,hasAnimated:!1})}}}let n=(0,s.create)()((0,r.devtools)((0,r.persist)((e,t,s)=>new a(e,t,s),{name:"highlights-storage",partialize:e=>({storyReactions:e.storyReactions})}),{name:"useHighlightsStore"}))},398459,e=>{"use strict";e.s(["HighlightsSection",()=>S,"HighlightsStoryRow",()=>v],398459);var t=e.i(637651),s=e.i(981176);e.i(685846);var i=e.i(526697),r=e.i(296451),l=e.i(19945),o=e.i(883440),a=e.i(235289),n=e.i(763578),h=e.i(723008),c=e.i(920958),d=e.i(486492),u=e.i(165275),g=e.i(211959);e.i(6880);var m=e.i(353315);e.i(968648);var x=e.i(873329),f=e.i(824027),p=e.i(676452),y=e.i(713216);function v(e){var a,h,f,y,v,S,j;let{story:I,onClick:w,borderless:b,mode:k="embedded"}=e,[N,C]=(0,m.useState)(!1),_=(0,c.useLogEvent)(),{t:M}=(0,x.useTranslation)("chat"),A=(0,p.useHighlightsStore)(e=>e.storyReactions),L=(0,m.useMemo)(()=>I.posts||[],[I.posts]),E=(0,m.useMemo)(()=>L.filter(e=>{var t;return(null==(t=e.entities)?void 0:t.media)&&e.entities.media.length>0}).sort((e,t)=>{var s,i;return((null==(s=t.publicMetrics)?void 0:s.likeCount)||0)-((null==(i=e.publicMetrics)?void 0:i.likeCount)||0)})[0]||L[0],[L]),H=null==E||null==(f=E.entities)||null==(h=f.media)||null==(a=h[0])?void 0:a.url,R=(null==E||null==(S=E.entities)||null==(v=S.media)||null==(y=v[0])?void 0:y.previewImageUrl)||H,P=R&&!N,T=A[I.storyId||""],D=(0,m.useMemo)(()=>{let e=Math.floor((Date.now()-new Date(I.createTime||0).getTime())/6e4);return e<60?"".concat(e,"m"):"".concat(Math.floor(e/60),"h")},[I.createTime]),B=(0,m.useMemo)(()=>L.reduce((e,t)=>{var s;return e+((null==(s=t.publicMetrics)?void 0:s.viewCount)||t.viewCount||0)},0),[L]),z=(0,m.useMemo)(()=>L.reduce((e,t)=>{var s;return e+((null==(s=t.publicMetrics)?void 0:s.likeCount)||0)},0),[L]),U=(0,m.useMemo)(()=>I.engagingPosts||[],[I.engagingPosts]),F=U[0],X=(0,m.useMemo)(()=>{let e=new Map;return[...L,...U].forEach(t=>{if(t.username){var s;let i=(null==(s=t.publicMetrics)?void 0:s.likeCount)||0,r=e.get(t.username);r?i>r.maxLikeCount&&(r.maxLikeCount=i,r.postId=t.postId,!r.verifiedType&&t.verifiedType&&(r.verifiedType=t.verifiedType)):e.set(t.username,{name:t.name||"",username:t.username||"",profileImageUrl:t.profileImageUrl,verifiedType:t.verifiedType,maxLikeCount:i,postId:t.postId})}}),Array.from(e.values()).sort((e,t)=>t.maxLikeCount-e.maxLikeCount)},[L,U]),O=(0,m.useCallback)(e=>{if(!I.storyId)return void(0,d.logError)("highlights-story-card:HighlightsStoryRow:handleClick","storyId is undefined",{story:JSON.stringify(I)});_("highlights_story_tapped",I.storyId,{location:"highlights-story-card:HighlightsStoryRow:click",storyId:I.storyId,title:I.title||""}),e.metaKey||e.ctrlKey||(e.preventDefault(),w(I.storyId))},[I,_,w]),G=(0,m.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!I.storyId)return;let t=p.useHighlightsStore.getState();_("highlight_story_liked",I.storyId,{location:"highlights-story-card:HighlightsStoryRow:handleLike",storyId:I.storyId,title:I.title||"",wasAlreadyLiked:String("liked"===T)}),t.likeStory(I.storyId)},[I.storyId,I.title,T,_]),V=(0,m.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!I.storyId)return;let t=p.useHighlightsStore.getState();_("highlight_story_disliked",I.storyId,{location:"highlights-story-card:HighlightsStoryRow:handleDislike",storyId:I.storyId,title:I.title||"",wasAlreadyDisliked:String("disliked"===T)}),t.dislikeStory(I.storyId)},[I.storyId,I.title,T,_]),W=(0,m.useMemo)(()=>X.slice(0,3),[X]);return(0,t.jsxs)("a",{href:"/highlights/".concat(I.storyId),className:(0,g.cn)("grid gap-y-2 gap-x-4",P?"grid-cols-[1fr_fit-content(200px)] grid-rows-[auto_24px]":"grid-cols-[1fr] grid-rows-[auto_24px]","overflow-hidden",b?"bg-transparent rounded-2xl":"border rounded-3xl bg-surface-l1","hover:bg-surface-l4-hover dark:hover:bg-surface-l2","ps-4 pe-3 py-3","w-full min-h-[90px]","text-start"),onClick:O,children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1.5 overflow-hidden col-span-1 row-span-1",children:[(0,t.jsx)("h3",{className:"text-primary font-semibold text-lg line-clamp-2 leading-tight m-0",children:I.title}),"authors"===k?(0,t.jsxs)(t.Fragment,{children:[I.summary&&(0,t.jsx)("p",{className:"text-secondary text-sm line-clamp-2 leading-snug m-0 mt-1",children:I.summary}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-auto overflow-hidden",children:[(0,t.jsx)("div",{className:"flex gap-1.5 flex-nowrap overflow-hidden flex-shrink min-w-0",children:W.map((e,s)=>(e.name,e.username,e.profileImageUrl,e.verifiedType,e.verifiedType,(0,t.jsxs)("div",{className:(0,g.cn)("flex items-center gap-1.5","ps-1 pe-2 py-1 rounded-full","bg-surface-l2 hover:bg-surface-l3","border border-border-l1","cursor-pointer transition-all","flex-shrink-0"),onClick:t=>{t.stopPropagation(),t.preventDefault(),e.postId&&(_("highlight_author_pill_clicked",e.postId,{location:"highlights-story-card:HighlightsStoryRow:authorPill",storyId:I.storyId||"",username:e.username,postId:e.postId}),window.open("https://x.com/".concat(e.username,"/status/").concat(e.postId),"_blank"))},children:[(0,t.jsx)("div",{className:"relative size-5 rounded-full bg-surface-l3 overflow-hidden flex-shrink-0",children:e.profileImageUrl?(0,t.jsx)("img",{src:e.profileImageUrl,alt:e.name,className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:(0,g.cn)("w-full h-full flex items-center justify-center","bg-gradient-to-br from-purple-500/30 via-blue-500/30 to-pink-500/30","text-primary text-[10px] font-medium"),children:e.name.charAt(0).toUpperCase()})}),(0,t.jsxs)("span",{className:"text-xs text-primary font-medium",children:["@",e.username]})]},e.username)))}),X.length>W.length&&(0,t.jsx)("div",{className:(0,g.cn)("flex items-center gap-1.5 flex-shrink-0"),children:(0,t.jsxs)("span",{className:"text-xs text-secondary font-medium whitespace-nowrap",children:["+",M("highlights-more-authors",{defaultValue_one:"{{count}} more",defaultValue_other:"{{count}} more",count:X.length-W.length})]})})]})]}):(0,t.jsxs)(t.Fragment,{children:[X.length>0&&(0,t.jsxs)("div",{className:"flex items-center gap-1 text-secondary text-sm mt-1",children:[(0,t.jsxs)("span",{children:["@",null==(j=X[0])?void 0:j.username]}),X.length>1&&(0,t.jsxs)("span",{className:"text-xs",children:["+",M("highlights-more-authors",{defaultValue_one:"{{count}} more",defaultValue_other:"{{count}} more",count:X.length-1})]})]}),F?(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)(s.XPostConversationCard,{xPost:F,wide:!0,disabled:!0,mode:"embedded"})}):I.summary&&(0,t.jsx)("p",{className:"text-secondary text-sm line-clamp-2 leading-snug m-0",children:I.summary})]})]}),P&&(0,t.jsx)("div",{className:"col-span-1 row-span-2 flex items-center justify-end",children:(0,t.jsx)("div",{className:"relative w-[200px] h-full max-h-[200px] rounded-xl overflow-hidden bg-surface-l2",children:(0,t.jsx)("img",{src:R,alt:I.title||M("highlights-story-media","Story media"),className:"w-full h-full object-cover",onError:()=>C(!0)})})}),(0,t.jsxs)("div",{className:"flex items-center h-min gap-4 text-secondary self-end text-xs col-span-1 row-span-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:G,className:(0,g.cn)("liked"===T&&"text-primary"),"aria-label":"Like this story",children:(0,t.jsx)(o.ThumbsUpIcon,{className:"size-4"})}),(0,t.jsx)(n.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:V,className:(0,g.cn)("disliked"===T&&"text-primary"),"aria-label":"Dislike this story",children:(0,t.jsx)(l.ThumbsDownIcon,{className:"size-4"})})]}),B>0&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(i.ChartBar,{className:"size-4 scale-x-[-1] rotate-90"}),(0,t.jsx)("span",{children:(0,u.formatNumber)(B)})]}),z>0&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(r.HeartIcon,{className:"size-4"}),(0,t.jsx)("span",{children:(0,u.formatNumber)(z)})]}),I.createTime&&(0,t.jsx)("span",{children:M("highlights-published-ago","Published {{time}} ago",{time:D})})]})]})}function S(e){let{className:i,story:r}=e,{t:v}=(0,x.useTranslation)("chat"),S=(0,c.useLogEvent)(),j=(0,m.useRef)(null),I=(0,m.useRef)(!1),w=(0,p.useHighlightsStore)(e=>e.storyReactions),{discussionPosts:b,isLoading:k,hasMore:N,loadMore:C}=function(e,t){let[s,i]=(0,m.useState)([]),[r,l]=(0,m.useState)(!1),[o,a]=(0,m.useState)(null),[n,h]=(0,m.useState)(void 0),[c,d]=(0,m.useState)(!0),u=(0,p.useHighlightsStore)(e=>e.getDiscussionPosts),g=(0,m.useRef)(!1);(0,m.useEffect)(()=>{e&&(i(null!=t?t:[]),h(void 0),d(!0),a(null))},[e,t]);let x=(0,m.useCallback)(async()=>{if(!g.current&&c&&e){g.current=!0,l(!0),a(null);try{let t=await u(e,20,n);i(e=>{let s=t.discussionPosts,i=new Set(e.map(e=>e.postId)),r=s.filter(e=>!i.has(e.postId));return[...e,...r]}),h(t.nextCursor),d(!!t.nextCursor)}catch(e){a(e instanceof Error?e:Error("Failed to load discussion posts")),d(!1)}finally{g.current=!1,l(!1)}}},[e,n,c,u]);return{discussionPosts:s,isLoading:r,error:o,hasMore:c,loadMore:x}}(r.storyId,r.discussionPosts),_=(0,m.useRef)(null),M=w[r.storyId||""],A=(0,m.useMemo)(()=>{let e=Math.floor((Date.now()-new Date(r.createTime||0).getTime())/6e4);return e<60?"".concat(e,"m"):"".concat(Math.floor(e/60),"h")},[r.createTime]),L=(0,m.useMemo)(()=>r.posts||[],[r.posts]),E=(0,m.useMemo)(()=>{let e=r.engagingPosts||[],t=new Set(L.map(e=>e.postId).filter(Boolean));return e.filter(e=>!t.has(e.postId))},[r.engagingPosts,L]),H=(0,m.useMemo)(()=>{let e=[...E,...b,...r.discussionPosts||[]],t=new Set;return e.filter(e=>!(!e.postId||t.has(e.postId))&&(t.add(e.postId),!0))},[E,b,r.discussionPosts]),R=(0,m.useCallback)(e=>{_.current&&_.current.disconnect(),e&&(_.current=new IntersectionObserver(e=>{let[t]=e;t&&t.isIntersecting&&N&&!k&&C().catch((0,d.createLogError)("highlights-story-card:loadMoreDiscussionPosts"))},{threshold:.1,rootMargin:"0px 0px 200px 0px"}),_.current.observe(e))},[N,k,C]);(0,m.useEffect)(()=>()=>{_.current&&_.current.disconnect()},[]);let P=(0,m.useMemo)(()=>{let e=[];return L.forEach(t=>{var s,i;let r=(null==(s=t.entities)?void 0:s.media)||[],l=[];if(r.forEach(e=>{let t=e.url||e.previewImageUrl;t&&l.push(t)}),l.length>0){let s=(null==(i=t.publicMetrics)?void 0:i.likeCount)||0;e.push({post:t,images:l,likeCount:s})}}),e.sort((e,t)=>t.likeCount-e.likeCount).flatMap(e=>e.images)},[L]),T=(0,m.useMemo)(()=>L.reduce((e,t)=>{var s;return e+((null==(s=t.publicMetrics)?void 0:s.viewCount)||t.viewCount||0)},0),[L]);(0,m.useEffect)(()=>{let e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&!I.current&&(I.current=!0,S("highlights_story_impression",r.storyId||"",{location:"highlights-section:HighlightsSection:impression",storyId:r.storyId||"",title:r.title||""}))})},{threshold:0});return j.current&&e.observe(j.current),()=>{e.disconnect()}},[r.storyId,r.title,S]);let D=(0,m.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!r.storyId)return;let t=p.useHighlightsStore.getState();S("highlight_story_liked",r.storyId,{location:"highlights-section:HighlightsSection:handleLike",storyId:r.storyId,title:r.title||"",wasAlreadyLiked:String("liked"===M)}),t.likeStory(r.storyId)},[r.storyId,r.title,M,S]),B=(0,m.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!r.storyId)return;let t=p.useHighlightsStore.getState();S("highlight_story_disliked",r.storyId,{location:"highlights-section:HighlightsSection:handleDislike",storyId:r.storyId,title:r.title||"",wasAlreadyDisliked:String("disliked"===M)}),t.dislikeStory(r.storyId)},[r.storyId,r.title,M,S]),z=(0,m.useCallback)(e=>{S("highlights_post_link_clicked",e,{location:"highlights-section:HighlightsSection:handlePostClick",storyId:r.storyId||"",postId:e})},[r.storyId,S]);return(0,t.jsxs)("section",{ref:j,id:r.storyId||void 0,className:(0,g.cn)("w-full scroll-mt-4",a.QUERY_BAR_MAX_WIDTH_CLASS,i),children:[P.length>0&&(0,t.jsxs)("div",{className:"relative w-full mb-6 rounded-2xl overflow-hidden",children:[(0,t.jsx)("img",{src:P[0],alt:"","aria-hidden":"true",className:"absolute inset-0 w-full h-full object-cover blur-3xl scale-110 opacity-60"}),(0,t.jsx)("img",{src:P[0],alt:r.title||v("highlights-story-image","Story image"),className:"relative w-full h-auto max-h-[600px] object-contain"})]}),(0,t.jsx)("h2",{className:"text-primary font-semibold text-2xl mb-2 m-0",children:r.title}),E.length>0&&(0,t.jsx)("div",{className:"mb-4 space-y-3",children:r.summary&&(0,t.jsx)("p",{className:"text-secondary text-base mb-4 m-0",children:r.summary})}),!E.length&&r.summary&&(0,t.jsx)("p",{className:"text-secondary text-base mb-4 m-0",children:r.summary}),(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:D,className:(0,g.cn)("liked"===M&&"text-primary"),"aria-label":v("highlights-like-story","Like this story"),children:(0,t.jsx)(o.ThumbsUpIcon,{className:"size-4"})}),(0,t.jsx)(n.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:B,className:(0,g.cn)("disliked"===M&&"text-primary"),"aria-label":v("highlights-dislike-story","Dislike this story"),children:(0,t.jsx)(l.ThumbsDownIcon,{className:"size-4"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-secondary text-sm",children:[T>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:v("highlights-views",{count:T,formattedCount:(0,u.formatNumber)(T),defaultValue_one:"{{formattedCount}} view",defaultValue_other:"{{formattedCount}} views"})}),(0,t.jsx)("span",{children:"Â·"})]}),(0,t.jsx)("span",{children:v("highlights-published-ago","Published {{time}} ago",{time:A})})]})]}),L.length>0&&(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsx)("div",{className:"flex flex-col overflow-hidden",children:L.map((e,i)=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{onClick:()=>z(e.postId||"unknown"),children:(0,t.jsx)(s.XPostConversationCard,{xPost:e,wide:!0,mode:"inline",showStats:{replies:!0,reposts:!0,likes:!0,views:!0},showMedia:!0})}),i<L.length-1&&(0,t.jsx)("div",{className:"h-px bg-border-l1 mx-4"})]},e.postId||i))})}),r.grokAnalysis&&(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsx)(y.MessageBubble,{isUser:!1,children:(0,t.jsx)(f.MemoizedMarkdown,{sender:"assistant",shouldRenderHtml:!0,children:r.grokAnalysis})})}),H.length>0&&(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h3",{className:"text-primary font-semibold text-lg mb-4",children:v("highlights-what-the-world-is-saying","What the world is saying")}),(0,t.jsxs)("div",{className:"flex flex-col overflow-hidden",children:[H.map((e,i)=>(0,t.jsxs)("div",{children:[(0,t.jsx)(s.XPostConversationCard,{xPost:e,wide:!0,mode:"inline",showStats:{replies:!0,reposts:!0,likes:!0,views:!0},showMedia:!0}),i<H.length-1&&(0,t.jsx)("div",{className:"h-px bg-border-l1 mx-4"})]},e.postId||"discussion-".concat(i))),(0,t.jsx)("div",{ref:R,className:"w-full h-1"}),k&&(0,t.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,t.jsx)(h.Spinner,{size:"sm"})})]})]})]})}},796066,e=>{"use strict";e.s(["useLoadHighlights",()=>l]);var t=e.i(353315),s=e.i(572848),i=e.i(676452),r=e.i(50636);function l(){let e=(0,s.useSession)().user,l=(0,r.useFeatureFlags)(),o=(0,i.useHighlightsStore)(e=>e.isLoading),a=(0,i.useHighlightsStore)(e=>e.error);return(0,t.useEffect)(()=>{if(!l.ALLOW_HIGHLIGHTS_ACCESS_WEB)return;let t=i.useHighlightsStore.getState();t.stories.length>=10||e&&!t.isLoading&&t.fetchStories(10).catch(e=>{})},[e,l.ALLOW_HIGHLIGHTS_ACCESS_WEB]),{isLoading:o,error:a}}},829735,584675,e=>{"use strict";e.s(["HighlightsAllStoriesPage",()=>D,"default",()=>T],829735);var t=e.i(637651),s=e.i(353315);e.i(968648);var i=e.i(873329),r=e.i(211959),l=e.i(486492),o=e.i(920958),a=e.i(235289),n=e.i(676452),h=e.i(796066),c=e.i(398459),d=e.i(724499),u=e.i(258722);e.i(685846);var g=e.i(352910),m=e.i(763578),x=e.i(380619),f=e.i(246429),p=e.i(389052),y=e.i(892621);e.s(["ArrowLeft",()=>v.default],584675);var v=e.i(688893),v=v,S=e.i(383293),j=e.i(383274),I=e.i(572848),w=e.i(443696),b=e.i(723008),k=e.i(713087),N=e.i(50636),C=e.i(328788),_=e.i(243634),M=e.i(157695),A=e.i(230433),L=e.i(805546),E=e.i(470753),H=e.i(6880);function R(){let{t:e}=(0,i.useTranslation)("chat"),h=(0,H.useParams)(),{route:g}=(0,d.useRouting)(),m="highlights"===g.page&&g.storyId||(null==h?void 0:h.id),R=(0,o.useLogEvent)(),{user:P}=(0,I.useSession)(),T=(0,j.useMaybeRefreshAnonSession)(),{signInWithReturnTo:D}=(0,k.useGrokRouter)(),B=(0,_.useForceSignInModels)(),z=(0,N.useFeatureFlags)(),U=(0,E.useSettingsStore)(e=>e.isIncognito),F=(0,C.useMobileSize)(),{bestSubscription:X}=(0,A.useSubscriptions)(),O=(0,L.useIsFirstTimeUser)(),G=(0,n.useHighlightsStore)(e=>e.getStory),V=(0,s.useMemo)(()=>m?G(m):void 0,[G,m]),{data:W,isUninitialized:Q,isLoading:K,error:Y}=(0,M.usePromise)(V),{sessionStartTime:q,conversationDepth:J}=(0,y.useTimeToValueAnalytics)();(0,s.useEffect)(()=>{W&&R("highlight_story_page_view",m,{location:"highlight-story-page",storyId:m,title:W.title||""})},[W,m,R]);let Z=(0,s.useCallback)(e=>{let{query:t,fileAttachmentIds:s,webpageUrls:i,toolOverrides:r,workspaceIds:o,persona:a,isIncognitoOverride:n,disableMemory:h,modelIdOverride:c}=e;if(!t||!t.trim())return Promise.resolve(!1);let d=f.useChatPageStore.getState(),g=E.useSettingsStore.getState(),m=u.useRoutingStore.getState();return!P&&B.includes(d.activeModelId)?(R("sign_in","highlight-story-page",{location:"highlight-story-page:handleSend"}),D(t),Promise.resolve(!1)):T().then(()=>{var e,u;let x=(0,p.toAnalytics)({activeModelId:c||d.activeModelId,modelMode:c?"":void 0,query:t,fileAttachmentIds:s,webpageUrls:i,location:"highlight-story-page",personalityId:g.userSettings.preferences.selectedSystemPromptId||"",personaId:"",sessionStartTime:q,conversationDepth:J,isMobile:F,bestSubscription:X,user:!!P,workspaceCount:(null==o?void 0:o.length)||0,toolOverrides:r,parentResponseId:"",isFirstTimeUser:O}),f=null==W||null==(e=W.posts)?void 0:e.map(e=>e.postId),y=null==W||null==(u=W.engagingPosts)?void 0:u.slice(0,2).map(e=>"@".concat(e.username,": ").concat(e.text)),v=[(null==W?void 0:W.title)&&"Story: ".concat(W.title),y&&y.length>0&&"Popular responses: ".concat(y.join(" | ")),!(null==y?void 0:y.length)&&(null==W?void 0:W.summary)&&"Summary: ".concat(W.summary),f&&"X posts: ".concat(f.join(", ")),t].filter(Boolean).join("\n\n");R("send_query","",x);let S=null!=n?n:U;return d.establishNewConversation({message:v,fileAttachmentIds:s,webpageUrls:i,toolOverrides:r,temporary:S,enableRetries:!0,ff:z,persona:a,disableMemory:h,onOptimisticConversation:()=>{m.push({page:"main"})}}).catch((0,l.createLogError)("highlight-story-page:establishNewConversation")).then(e=>!!e)})},[P,B,T,W,q,J,F,X,O,R,D,U,z]),$=(0,s.useCallback)(()=>{(0,u.useRoutingStore.getState().push)({page:"main"})},[]);return Q||K?(0,t.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,t.jsx)(b.Spinner,{})}):Y||!W?(0,t.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,t.jsx)("div",{className:(0,r.cn)("w-full",a.QUERY_BAR_MAX_WIDTH_CLASS),children:(0,t.jsx)("p",{className:"text-secondary text-center",children:e("highlight-not-found","Highlight story not found.")})})}):(0,t.jsxs)("div",{className:(0,r.cn)("flex flex-col items-center w-full h-[100vh]",x.CHAT_CONTAINER_CLASSES),children:[(0,t.jsx)("div",{className:"flex-1 w-full overflow-y-auto",children:(0,t.jsxs)("div",{className:(0,r.cn)("w-full",a.QUERY_BAR_MAX_WIDTH_CLASS,"mx-auto px-4 relative"),children:[(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)(w.Button,{variant:"tertiary",size:"md",shape:"circle",onClick:$,className:"shrink-0","aria-label":e("highlights-detail-page.back","Back"),children:(0,t.jsx)(v.default,{size:20})})}),(0,t.jsx)(c.HighlightsSection,{className:"pt-3",story:W}),(0,t.jsx)("div",{className:"h-32"})]})}),(0,t.jsxs)("div",{className:(0,r.cn)("absolute bottom-4 w-full"),children:[(0,t.jsx)(S.QueryBar,{placeholder:e("highlights-story-page-query-bar.input-placeholder","Ask about the story..."),onQuery:Z,onFrontPage:!0,isIncognito:U,textAreaClassName:"min-h-14 py-4 my-0 mb-0"}),(0,t.jsx)("div",{className:"absolute -bottom-4 h-14 w-full",children:(0,t.jsx)("div",{className:(0,r.cn)("chat-input-backdrop w-full h-full","bg-gradient-to-b from-surface-base via-surface-base/94 to-surface-base/80")})})]})]})}function P(e){let{children:s}=e,i=(0,u.useRoutingStore)(e=>e.push);return(0,t.jsxs)("div",{className:(0,r.cn)("flex flex-col items-center w-full h-[100vh] overflow-y-auto",x.CHAT_CONTAINER_CLASSES),children:[(0,t.jsx)(m.Button,{variant:"outline",size:"iconMd",rounded:!0,onClick:()=>i({page:"main"}),className:"shrink-0 mt-2 ms-2 self-start sticky top-2",children:(0,t.jsx)(g.ChevronLeft,{className:"size-4"})}),(0,t.jsx)("div",{className:(0,r.cn)("w-full",a.QUERY_BAR_MAX_WIDTH_CLASS),children:s})]})}function T(){let{route:e}=(0,d.useRouting)();return"highlights"===e.page&&e.storyId?(0,t.jsx)(R,{}):(0,t.jsx)(D,{})}function D(){let{t:e}=(0,i.useTranslation)("chat"),{route:r}=(0,d.useRouting)(),a=(0,n.useHighlightsStore)(e=>e.stories),{isLoading:u,error:g}=(0,h.useLoadHighlights)(),m=(0,o.useLogEvent)();return((0,s.useEffect)(()=>{a.length>0&&m("highlights_shown",String(a.length),{location:"highlights-page:HighlightsAllStoriesView",storyCount:String(a.length)})},[a.length,m]),(0,s.useEffect)(()=>{if("highlights"===r.page&&r.storyId){let e=setTimeout(()=>{let e=r.storyId;if(e){let t=document.getElementById(e);t?t.scrollIntoView({behavior:"smooth",block:"start"}):(0,l.logError)("highlights-page:scroll",Error("Story element not found: ".concat(e)))}},100);return()=>clearTimeout(e)}},[r]),u&&0===a.length)?(0,t.jsx)(P,{children:(0,t.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,t.jsx)("p",{className:"text-secondary text-center",children:e("highlights-loading","Loading highlights...")})})}):g?(0,t.jsx)(P,{children:(0,t.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,t.jsx)("p",{className:"text-secondary text-center",children:e("highlights-error","Failed to load highlights. Please try again later.")})})}):0===a.length?(0,t.jsx)(P,{children:(0,t.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,t.jsx)("p",{className:"text-secondary text-center",children:e("highlights-empty","No highlights available at the moment.")})})}):(0,t.jsx)(P,{children:(0,t.jsx)("div",{className:"flex flex-col gap-10",children:a.map(e=>(0,t.jsx)(c.HighlightsSection,{story:e},e.storyId))})})}}]);
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="45f28f98-96b2-5d0c-8fbd-1d1f770b01ab")}catch(e){}}();
//# debugId=45f28f98-96b2-5d0c-8fbd-1d1f770b01ab
